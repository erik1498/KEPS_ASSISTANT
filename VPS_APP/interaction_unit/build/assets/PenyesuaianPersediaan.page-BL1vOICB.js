import{w as C,r as i,a7 as L,j as a,d as O,Q as R,e as B,p as I,m as z,bW as F,t as P,bU as $,as as A,R as K,W as U,x as G,y as E,f as W,z as H,b as J,F as V,D,v as Q}from"./index-Cxe6xZhx.js";import{P as Y}from"./Pagination-DozK1MC-.js";import{F as q}from"./FormInputWithLabel-ChP85Rz6.js";import{P as M,l as X}from"./PDFHeader-DZh2pm8P.js";import"./react-paginate-C9qDTwCE.js";import"./index-BKNjMPK8.js";const Z=({setAddPenyesuaianPersediaanEvent:l=()=>{},penyesuaianPersediaanEdit:r,getData:c=()=>{}})=>{const j=C(),{data:x}=j,[m,f]=i.useState(r!=null&&r.penyesuaian_persediaan_tanggal?r.penyesuaian_persediaan_tanggal:L()),[o,b]=i.useState(r!=null&&r.uuid?r.uuid:""),[w,N]=i.useState([]),[n,_]=i.useState([]),k=async e=>{F.custom(`${n[e].uuid!=""?`/${n[e].uuid}`:""}`,n[e].uuid!=""?"PUT":"POST",null,{data:{tanggal:m,perintah_stok_opname:o.value,hasil_stok_opname:n[e].hasil_stok_opname,kuantitas:`${n[e].kuantitas}`,stok_tersedia_sistem:`${n[e].stok_sistem}`,tipe_penyesuaian:`${n[e].tipe_penyesuaian}`,jumlah:`${d(n[e])}`,keterangan:n[e].keterangan}}).then(()=>{e+1<n.length?k(e+1):(c(),l())}).catch(h=>{P(h)})},v=()=>{$.custom(`?tahun=${x.tahun}`,"GET").then(e=>{if(N(e.data.entry),e.data.entry.length>0){if(r){A({editObject:r.uuid,dataList:e.data.entry,setState:b,labelKey:"nomor_surat_perintah",valueKey:"uuid"});return}b({label:e.data.entry[0].nomor_surat_perintah,value:e.data.entry[0].uuid})}}).catch(e=>P(e))},u=()=>{F.custom(`/daftar_barang/${o.value}`,"GET").then(e=>{_(e.data)}).catch(e=>P(e))},y=(e,h)=>{let g=n;g=g.map(p=>(p.stok_awal_barang==h&&(p.keterangan=e),p)),_(p=>g)},d=e=>e.tipe_penyesuaian!="SESUAI"?e.tipe_penyesuaian=="PENGURANGAN"?parseInt(e.stok_sistem)-parseInt(e.kuantitas):parseInt(e.kuantitas)-parseInt(e.stok_sistem):"0";return i.useEffect(()=>{o&&u()},[o]),i.useEffect(()=>{v()},[]),a.jsx(a.Fragment,{children:a.jsxs("div",{className:"bg-white px-6 py-3 rounded-md shadow-2xl",children:[a.jsxs("div",{className:"mb-3 flex justify-between items-center",children:[a.jsxs("h1",{className:"uppercase text-gray-600 font-bold",children:[r?"Edit":"Tambahkan"," Penyesuaian Persediaan"]}),a.jsxs("button",{className:"btn btn-sm bg-red-900 text-white border-none",onClick:()=>l(),children:[a.jsx(O,{})," Batalkan Penyesuaian Persediaan"]})]}),a.jsxs("div",{className:"flex gap-x-2",children:[a.jsx(q,{label:"Tanggal",type:"datetime-local",onchange:e=>{f(e.target.value)},others:{value:m,name:"tanggal"}}),a.jsx(R,{label:"Perintah Stok Opname",optionsDataList:w,optionsLabel:"nomor_surat_perintah",optionsValue:"uuid",disabled:!0,selectValue:o,onchange:e=>{b(e)},selectName:"perintahStokOpname"})]}),a.jsx("div",{className:"overflow-x-auto rounded-md h-max max-h-[90vh] no-scrollbar mt-5 pb-4",children:a.jsxs("table",{className:"table",children:[a.jsx("thead",{children:a.jsxs("tr",{className:"sticky top-0 bg-white py-4 text-black",children:[a.jsx("th",{width:12,children:"No"}),a.jsx("th",{children:"Kode Barang"}),a.jsx("th",{children:"Nama Barang"}),a.jsx("th",{children:"Satuan Barang"}),a.jsx("th",{children:"Stok Sistem"}),a.jsx("th",{children:"Kuantitas"}),a.jsx("th",{children:"Tipe Penyesuaian"}),a.jsx("th",{children:"Jumlah"}),a.jsx("th",{children:"Keterangan"})]})}),a.jsx("tbody",{children:n==null?void 0:n.map((e,h)=>a.jsx(a.Fragment,{children:a.jsxs("tr",{children:[a.jsxs("td",{children:[h+1,"."]}),a.jsx("td",{children:e.kategori_harga_barang_kode_barang}),a.jsx("td",{children:e.daftar_barang_name}),a.jsx("td",{children:e.satuan_barang_name}),a.jsx("td",{children:e.stok_sistem}),a.jsx("td",{children:e.kuantitas}),a.jsx("td",{children:e.tipe_penyesuaian}),a.jsx("td",{children:d(e)}),a.jsx("td",{children:a.jsx(B,{name:"keterangan_"+h,type:"text",other:{defaultValue:e.keterangan},onchange:g=>{y(g.target.value,e.stok_awal_barang)},value:I(e.keterangan)})})]},h)}))})]})}),a.jsxs("button",{className:"btn btn-sm bg-green-800 mt-4 text-white",onClick:()=>{k(0)},children:[a.jsx(z,{})," Simpan"]})]})})};K.forwardRef((l,r)=>{var c;return a.jsxs("div",{ref:r,children:[a.jsx(M,{bulan:l.bulan,tahun:l.tahun,title:"Penyesuaian Persediaan"}),a.jsxs("table",{className:"table",children:[a.jsx("thead",{children:a.jsxs("tr",{className:"sticky top-0 bg-white py-4 text-black",children:[a.jsx("th",{width:12,children:"No"}),a.jsx("th",{children:"Nama Penyesuaian Persediaan"})]})}),a.jsx("tbody",{children:(c=l==null?void 0:l.data)==null?void 0:c.map((j,x)=>a.jsx(a.Fragment,{children:a.jsxs("tr",{children:[a.jsx("td",{children:x+1}),a.jsx("td",{children:j.name})]},x)}))})]})]})});const ia=()=>{const l=C(),{data:r}=l,[c,j]=i.useState([]),[x,m]=i.useState(!1),[f,o]=i.useState(!1),[b,w]=i.useState({name:""}),[N,n]=i.useState(!1),[_,k]=i.useState(""),v=i.useRef();X.useReactToPrint({content:()=>v.current});const[u,y]=i.useState({page:1,size:10,count:118,lastPage:12}),d=(s="")=>{s==""&&k(s),m(!0),$.custom(`?search=${s}&page=${u.page}&size=${u.size}&tahun=${r.tahun}`,"GET").then(t=>{var S,T;n(s.length<1),j((S=t==null?void 0:t.data)==null?void 0:S.entry),y((T=t==null?void 0:t.data)==null?void 0:T.pagination),m(!1)}).catch(t=>{P(t)})},e=s=>{let t=c[s];w(t),o(!f)},h=async s=>{if(await D("Hapus","Yakin ingin hapus data ini ?")){let t=c[s];F.custom(`/${t.uuid}`,"DELETE").then(()=>{Q("Berhasil","Data berhasil dihapus"),d()}).catch(S=>{P(S)})}},g=({selected:s})=>{let t=u;t.page=s+1,y(t),d()},p=s=>{let t=u;t.size=s,t.page=1,y(t),d()};return i.useEffect(()=>{d()},[]),a.jsx(U,{isLoading:x,children:a.jsxs("div",{children:[a.jsx(G,{title:"Penyesuaian Persediaan"}),f?a.jsx(Z,{setAddPenyesuaianPersediaanEvent:()=>o(!1),getData:d,penyesuaianPersediaanEdit:b}):a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"bg-white py-3 px-6 mb-3 rounded-md flex justify-between shadow-2xl",children:a.jsxs("label",{className:"input input-sm input-bordered flex items-center gap-2 bg-white",children:[a.jsx("input",{type:"text",className:"grow bg-transparent",placeholder:"Cari",value:_,onChange:s=>k(s.target.value)}),N?a.jsx(E,{onClick:()=>{d(_)},className:"cursor-pointer"}):a.jsx(O,{onClick:()=>d(""),className:"cursor-pointer"})]})}),a.jsx("div",{className:"overflow-x-auto bg-white shadow-xl rounded-md h-[50vh] no-scrollbar px-6 pb-4",children:a.jsxs("table",{className:"table",children:[a.jsx("thead",{children:a.jsxs("tr",{className:"sticky top-0 bg-white py-4 text-black",children:[a.jsx("th",{width:12,children:"No"}),a.jsx("th",{children:"Tanggal"}),a.jsx("th",{children:"Bulan Transaksi"}),a.jsx("th",{children:"Nomor Penyesuaian Persediaan"}),a.jsx("th",{children:"Pegawai Penanggung Jawab"}),a.jsx("th",{children:"Pegawai Pelaksana"}),a.jsx("th",{children:"Kategori Barang"}),a.jsx("th",{children:"Gudang Asal"}),a.jsx("th",{children:"Aksi"})]})}),a.jsx("tbody",{children:c==null?void 0:c.map((s,t)=>a.jsx(a.Fragment,{children:a.jsxs("tr",{children:[a.jsxs("td",{children:[t+1,"."]}),a.jsx("td",{children:W(s.penyesuaian_persediaan_tanggal,!0)}),a.jsx("td",{children:H(s.bulan_transaksi-1)}),a.jsx("td",{children:s.nomor_surat_perintah}),a.jsx("td",{children:s.pegawai_penanggung_jawab_name}),a.jsx("td",{children:s.pegawai_pelaksana_name}),a.jsx("td",{children:s.kategori_barang_name}),a.jsx("td",{children:s.daftar_gudang_name}),a.jsxs("td",{className:"flex gap-x-2",children:[a.jsx(J,{size:12,className:"text-yellow-500 cursor-pointer",onClick:()=>{e(t)}}),s.penyesuaian_persediaan_count>0?a.jsx(a.Fragment,{children:a.jsx(V,{size:12,className:"text-red-500 cursor-pointer",onClick:()=>{h(t)}})}):a.jsx(a.Fragment,{})]})]},t)}))})]})}),a.jsx(Y,{paginateUpdatePage:g,paginate:u,setSize:p})]})]})})};export{ia as default};
