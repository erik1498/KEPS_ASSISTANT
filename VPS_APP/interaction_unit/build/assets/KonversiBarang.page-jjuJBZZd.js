import{r as o,j as a,e as T,p as C,h as O,m as U,ax as G,t as k,a7 as A,d as D,Q as P,o as I,ay as F,v as B,aw as J,as as R,at as W,R as Y,w as M,W as Q,x as q,y as X,l as Z,z as E,n as aa,b as ea,F as ta,D as na}from"./index-s7IRrMev.js";import{P as sa}from"./Pagination-BqCrcN68.js";import{F as $}from"./FormInputWithLabel-DNO00jay.js";import{i as z}from"./actionEvent.helper-ukgjnBmu.js";import{P as ra,l as la}from"./PDFHeader-mTwqq47U.js";import"./react-paginate-B2Dhbjlf.js";import"./index-BKNjMPK8.js";const V=({konversiBarang:c,satuanBarangKonversiBarang:t,preview:d})=>{const[h,_]=o.useState([]),[g,b]=o.useState([]),[j,p]=o.useState([]),m=()=>{G.custom(`/by_konversi_barang/${c.uuid}`).then(e=>{_(r=>e.data)}).catch(e=>k(e))},v=(e,r)=>{let n=g;n=n.map(s=>(s.stok_awal_barang==r&&(s.jumlah_yang_dikonversi=e),s)),b(s=>n)},w=(e,r)=>{let n=g;n=n.map(s=>(s.stok_awal_barang==r&&(s.jumlah_hasil_konversi_kode_barang_tujuan=e),s)),b(s=>n)},K=(e,r)=>{let n=g;n=n.map(s=>(s.stok_awal_barang==r&&(s.stok_awal_barang_tujuan=e.value),s)),b(s=>n)},y=()=>{g.map(async e=>{await G.custom(e.uuid?`/${e.uuid}`:"",e.uuid?"PUT":"POST",null,{data:{konversi_barang:c.uuid,stok_awal_barang:e.stok_awal_barang,jumlah_yang_dikonversi:`${e.jumlah_yang_dikonversi}`,stok_awal_barang_tujuan:e.stok_awal_barang_tujuan,jumlah_hasil_konversi_kode_barang_tujuan:`${e.jumlah_hasil_konversi_kode_barang_tujuan}`}}).catch(r=>k(r))})},f=e=>{const r=h.filter(n=>n.stok_awal_barang==e);return r.length>0?{label:r[0].kategori_harga_barang_kode_barang,value:r[0].satuan_barang_name}:null},x=e=>{const r=h.filter(n=>n.stok_awal_barang==e);return r.length>0?r[0].satuan_barang_name:null};return o.useEffect(()=>{const e=h.filter(n=>n.satuan_barang_uuid==t.value),r=h.filter(n=>n.satuan_barang_uuid!=t.value);b(n=>e),p(n=>r)},[h]),o.useEffect(()=>{m()},[c]),a.jsx(a.Fragment,{children:a.jsxs("div",{className:"my-5 bg-white py-5 rounded-md",children:[a.jsx("h1",{className:"text-xl font-extrabold w-max text-white px-2 rounded-md bg-blue-900 mb-4",children:"Daftar Barang"}),a.jsx("div",{className:"overflow-x-auto max-h-[40vh] h-max no-scrollbar pb-4",children:a.jsxs("table",{className:"table",children:[a.jsx("thead",{children:a.jsxs("tr",{className:"sticky top-0 z-50 bg-white py-4 text-black",children:[a.jsx("th",{width:12,children:"No"}),a.jsx("th",{children:"Nama Barang"}),a.jsx("th",{children:"Kode Barang"}),a.jsx("th",{children:"Satuan Barang"}),a.jsx("th",{width:150,children:"Jumlah Yang Konversi"}),a.jsx("th",{width:200,children:"Kode Barang Tujuan"}),a.jsx("th",{children:"Satuan Barang Tujuan"}),a.jsx("th",{width:150,children:"Jumlah Hasil Konversi Kode Barang Tujuan"})]})}),a.jsx("tbody",{children:g==null?void 0:g.map((e,r)=>{var n;return a.jsx(a.Fragment,{children:a.jsxs("tr",{children:[a.jsxs("td",{children:[r+1,"."]}),a.jsx("td",{children:e.daftar_barang_nama_barang}),a.jsx("td",{children:e.kategori_harga_barang_kode_barang}),a.jsx("td",{children:e.satuan_barang_name}),a.jsx("td",{children:d?a.jsx(a.Fragment,{children:e.jumlah_yang_dikonversi}):a.jsx(a.Fragment,{children:a.jsx(T,{name:"jumlah_yang_dikonversi",type:"text",other:{defaultValue:e.jumlah_yang_dikonversi},onchange:s=>{z(s),v(s.target.value,e.stok_awal_barang)},value:C(e.jumlah_yang_dikonversi)})})}),a.jsx("td",{children:d?a.jsx(a.Fragment,{children:(n=f(e.stok_awal_barang_tujuan))==null?void 0:n.label}):a.jsx(a.Fragment,{children:a.jsx(O,{optionsDataList:j.filter(s=>s.daftar_barang_uuid==e.daftar_barang_uuid),optionsLabel:"kategori_harga_barang_kode_barang",optionsValue:"stok_awal_barang",selectValue:f(e.stok_awal_barang_tujuan),onchange:s=>{K(s,e.stok_awal_barang)},selectName:"satuanBarangKonversiBarang"})})}),a.jsx("td",{children:x(e.stok_awal_barang_tujuan)}),a.jsx("td",{children:d?a.jsx(a.Fragment,{children:e.jumlah_hasil_konversi_kode_barang_tujuan}):a.jsx(a.Fragment,{children:a.jsx(T,{name:"jumlah",type:"text",other:{defaultValue:e.jumlah_hasil_konversi_kode_barang_tujuan},onchange:s=>{z(s),w(s.target.value,e.stok_awal_barang)},value:C(e.jumlah_hasil_konversi_kode_barang_tujuan)})})})]},r)})})})]})}),d?a.jsx(a.Fragment,{}):a.jsx(a.Fragment,{children:a.jsxs("button",{className:"btn btn-sm bg-green-800 mt-3 text-white",onClick:()=>{y()},children:[a.jsx(U,{})," Simpan"]})})]})})},ia=({setAddKonversiBarangEvent:c=()=>{},konversiBarangEdit:t,getData:d=()=>{}})=>{const[h,_]=o.useState(t!=null&&t.tanggal?t.tanggal:A()),[g,b]=o.useState(t!=null&&t.kode_konversi_barang?t.kode_konversi_barang:""),[j,p]=o.useState(t!=null&&t.daftar_gudang?t.daftar_gudang:""),[m,v]=o.useState(t!=null&&t.satuan_barang?t.satuan_barang:""),[w,K]=o.useState([]),[y,f]=o.useState([]),[x,e]=o.useState(),r=async()=>{await I()&&F.custom(`${t!=null&&t.uuid?`/${t.uuid}`:""}`,t?"PUT":"POST",null,{data:{tanggal:h,kode_konversi_barang:g,daftar_gudang:j.value,satuan_barang:m.value}}).then(l=>{t?(e(S=>t),B("Berhasil","Data berhasil diupdate")):(e(S=>l.data),B("Berhasil","Data berhasil disimpan"))}).catch(l=>{k(l)})},n=()=>{J.custom("","GET").then(l=>{if(K(S=>l.data.entry),l.data.entry.length>0){if(t){R({editObject:t.daftar_gudang,dataList:l.data.entry,setState:p,labelKey:"name",valueKey:"uuid"});return}p({label:l.data.entry[0].name,value:l.data.entry[0].uuid})}})},s=()=>{W.custom("","GET").then(l=>{if(f(S=>l.data.entry),l.data.entry.length>0){if(t){R({editObject:t.satuan_barang,dataList:l.data.entry,setState:v,labelKey:"name",valueKey:"uuid"});return}v({label:l.data.entry[0].name,value:l.data.entry[0].uuid})}})};return o.useEffect(()=>{n(),s()},[]),a.jsx(a.Fragment,{children:a.jsxs("div",{className:"bg-white px-6 py-3 rounded-md shadow-2xl",children:[a.jsxs("div",{className:"mb-3 flex justify-between items-center",children:[a.jsxs("h1",{className:"uppercase text-gray-600 font-bold",children:[t?"Edit":"Tambahkan"," Konversi Barang"]}),a.jsxs("button",{className:"btn btn-sm bg-red-900 text-white border-none",onClick:()=>{d(),c()},children:[a.jsx(D,{})," Batalkan Konversi Barang"]})]}),a.jsxs("div",{className:"flex gap-x-2",children:[a.jsx($,{label:"Tanggal Konversi Barang",type:"datetime-local",onchange:l=>{_(l.target.value)},others:{value:h,disabled:x,tanggal:"tanggalKonversiBarang"}}),a.jsx($,{label:"Kode Konversi Barang",type:"text",onchange:l=>{b(l.target.value)},others:{value:g,disabled:x,tanggal:"kodeKonversiBarang"}}),a.jsx(P,{label:"Gudang",optionsDataList:w,optionsLabel:"name",optionsValue:"uuid",selectValue:j,disabled:x,onchange:l=>{p(l)},selectName:"gudangKonversiBarang"}),a.jsx(P,{label:"Satuan Barang",optionsDataList:y,optionsLabel:"name",optionsValue:"uuid",selectValue:m,disabled:x,onchange:l=>{v(l)},selectName:"satuanBarangKonversiBarang"})]}),x?a.jsx(a.Fragment,{children:a.jsx(V,{konversiBarang:x,satuanBarangKonversiBarang:m})}):a.jsx(a.Fragment,{children:a.jsxs("button",{className:"btn btn-sm bg-green-800 mt-4 text-white",onClick:()=>{r()},children:[a.jsx(U,{})," Simpan"]})}),t&&!x?a.jsx(a.Fragment,{children:a.jsx(V,{konversiBarang:t,satuanBarangKonversiBarang:{value:t.satuan_barang},preview:!0})}):a.jsx(a.Fragment,{})]})})},oa=Y.forwardRef((c,t)=>{var d;return a.jsxs("div",{ref:t,children:[a.jsx(ra,{bulan:c.bulan,tahun:c.tahun,title:"Konversi Barang"}),a.jsxs("table",{className:"table",children:[a.jsx("thead",{children:a.jsxs("tr",{className:"sticky top-0 bg-white py-4 text-black",children:[a.jsx("th",{width:12,children:"No"}),a.jsx("th",{children:"Nama Konversi Barang"})]})}),a.jsx("tbody",{children:(d=c==null?void 0:c.data)==null?void 0:d.map((h,_)=>a.jsx(a.Fragment,{children:a.jsxs("tr",{children:[a.jsx("td",{children:_+1}),a.jsx("td",{children:h.name})]},_)}))})]})]})}),_a=()=>{const c=M(),{data:t}=c,[d,h]=o.useState([]),[_,g]=o.useState(!1),[b,j]=o.useState(!1),[p,m]=o.useState({name:""}),[v,w]=o.useState(!1),[K,y]=o.useState(""),f=o.useRef(),x=la.useReactToPrint({content:()=>f.current}),[e,r]=o.useState({page:1,size:10,count:118,lastPage:12}),n=(u="")=>{u==""&&y(u),g(!0),F.custom(`?search=${u}&page=${e.page}&size=${e.size}&tahun=${t.tahun}`,"GET").then(i=>{var N,L;w(u.length<1),h((N=i==null?void 0:i.data)==null?void 0:N.entry),r((L=i==null?void 0:i.data)==null?void 0:L.pagination),g(!1)}).catch(i=>{k(i)})},s=u=>{let i=d[u];m(i),j(!b)},l=async u=>{if(await na("Hapus","Yakin ingin hapus data ini ?")){let i=d[u];F.custom(`/${i.uuid}`,"DELETE").then(()=>{B("Berhasil","Data berhasil dihapus"),n()}).catch(N=>{k(N)})}},S=({selected:u})=>{let i=e;i.page=u+1,r(i),n()},H=u=>{let i=e;i.size=u,i.page=1,r(i),n()};return o.useEffect(()=>{n()},[]),a.jsx(Q,{isLoading:_,children:a.jsxs("div",{children:[a.jsx(q,{title:"Konversi Barang"}),b?a.jsx(ia,{setAddKonversiBarangEvent:()=>j(!1),getData:n,konversiBarangEdit:p}):a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"bg-white py-3 px-6 mb-3 rounded-md flex justify-between shadow-2xl",children:[a.jsxs("label",{className:"input input-sm input-bordered flex items-center gap-2 bg-white",children:[a.jsx("input",{type:"text",className:"grow bg-transparent",placeholder:"Cari",value:K,onChange:u=>y(u.target.value)}),v?a.jsx(X,{onClick:()=>{n(K)},className:"cursor-pointer"}):a.jsx(D,{onClick:()=>n(""),className:"cursor-pointer"})]}),a.jsxs("div",{className:"flex gap-x-2 items-center",children:[a.jsxs("button",{className:"btn btn-sm bg-blue-900 text-white border-none",onClick:()=>{m(null),j(!b)},children:[a.jsx(Z,{})," Tambah Konversi Barang"]}),a.jsx("div",{className:"hidden",children:a.jsx(oa,{data:d,ref:f,bulan:E(new Date().getMonth()),tahun:t.tahun})}),a.jsxs("button",{onClick:x,className:"btn btn-sm bg-red-600 hover:bg-red-600 text-white border-red-600",children:[a.jsx(aa,{})," Cetak Konversi Barang"]})]})]}),a.jsx("div",{className:"overflow-x-auto bg-white shadow-xl rounded-md h-[50vh] no-scrollbar px-6 pb-4",children:a.jsxs("table",{className:"table",children:[a.jsx("thead",{children:a.jsxs("tr",{className:"sticky top-0 bg-white py-4 text-black",children:[a.jsx("th",{width:12,children:"No"}),a.jsx("th",{children:"Tanggal"}),a.jsx("th",{children:"Kode"}),a.jsx("th",{children:"Aksi"})]})}),a.jsx("tbody",{children:d==null?void 0:d.map((u,i)=>a.jsx(a.Fragment,{children:a.jsxs("tr",{children:[a.jsxs("td",{children:[i+1,"."]}),a.jsx("td",{children:u.tanggal}),a.jsx("td",{children:u.kode_konversi_barang}),a.jsxs("td",{className:"flex gap-x-2",children:[a.jsx(ea,{size:12,className:"text-yellow-500 cursor-pointer",onClick:()=>{s(i)}}),a.jsx(ta,{size:12,className:"text-red-500 cursor-pointer",onClick:()=>{l(i)}})]})]},i)}))})]})}),a.jsx(sa,{paginateUpdatePage:S,paginate:e,setSize:H})]})]})})};export{_a as default};
