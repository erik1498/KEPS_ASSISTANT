import{r,j as a,h as G,aC as L,s as k,O,b as $,k as D,aD as F,n as S,ax as U,R as V,u as I,o as W,e as H,p as J,i as q,a as M,F as Y,q as Q}from"./index-DZCXWm7f.js";import{P as X}from"./PageTitle-CmhTXHkp.js";import{f as P,W as Z}from"./Wrap-DcwCOsCB.js";import{P as E}from"./Pagination-CKy31gga.js";import{F as A}from"./FormInputWithLabel-CJ6pr1p6.js";import{F as R}from"./FormSelectWithLabel-BRttMTTK.js";import{i as aa}from"./actionEvent.helper-BujKUZ7B.js";import{p as ea}from"./number.helper-efe0YCx6.js";import{F as ta}from"./FormInput-BS-RLPlt.js";import{P as sa,l as na}from"./PDFHeader-C5EAnyc_.js";import"./react-paginate-DQywGu_z.js";import"./index-BKNjMPK8.js";const B=({transferBarang:d,preview:e})=>{const[n,u]=r.useState([]),g=()=>{L.custom(`/by_transfer_barang/${d.uuid}`).then(t=>{u(c=>t.data)}).catch(t=>k(t))},p=(t,c)=>{let o=n;o=o.map(h=>(h.stok_awal_barang==c&&(h.jumlah=t),h)),u(h=>o)},x=t=>{n[t].stok_awal_barang_tujuan?L.custom(n[t].uuid?`/${n[t].uuid}`:"",n[t].uuid?"PUT":"POST",null,{data:{transfer_barang:d.uuid,stok_awal_barang:n[t].stok_awal_barang,jumlah:n[t].jumlah,stok_awal_barang_tujuan:n[t].stok_awal_barang_tujuan}}).then(()=>{t<n.length-1?x(t+1):g()}).catch(c=>k(c)):x(t+1)};return r.useEffect(()=>{g()},[d]),a.jsx(a.Fragment,{children:a.jsxs("div",{className:"my-5 bg-white py-5 rounded-md",children:[a.jsx("h1",{className:"text-xl font-extrabold w-max text-white px-2 rounded-md bg-blue-900 mb-4",children:"Daftar Barang"}),a.jsx("div",{className:"overflow-x-auto max-h-[40vh] h-max no-scrollbar pb-4",children:a.jsxs("table",{className:"table",children:[a.jsx("thead",{children:a.jsxs("tr",{className:"sticky top-0 z-50 bg-white py-4 text-black",children:[a.jsx("th",{width:12,children:"No"}),a.jsx("th",{children:"Nama Barang"}),a.jsx("th",{children:"Kode Barang"}),a.jsx("th",{children:"Satuan Barang"}),a.jsx("th",{width:150,children:"Jumlah"})]})}),a.jsx("tbody",{children:n==null?void 0:n.map((t,c)=>t.stok_awal_barang_tujuan&&a.jsx(a.Fragment,{children:a.jsxs("tr",{children:[a.jsxs("td",{children:[c+1,"."]}),a.jsx("td",{children:t.daftar_barang_nama_barang}),a.jsx("td",{children:t.kategori_harga_barang_kode_barang}),a.jsx("td",{children:t.satuan_barang}),a.jsx("td",{children:e?a.jsx(a.Fragment,{children:t.jumlah}):a.jsx(a.Fragment,{children:a.jsx(ta,{name:"jumlah",type:"text",other:{defaultValue:t.jumlah},onchange:o=>{aa(o),p(o.target.value,t.stok_awal_barang)},value:ea(t.jumlah)})})})]},c)}))})]})}),e?a.jsx(a.Fragment,{}):a.jsx(a.Fragment,{children:a.jsxs("button",{className:"btn btn-sm bg-green-800 mt-3 text-white",onClick:()=>{x(0)},children:[a.jsx(G,{})," Simpan"]})})]})})},la=({setAddTransferBarangEvent:d=()=>{},transferBarangEdit:e,getData:n=()=>{}})=>{const[u,g]=r.useState(e!=null&&e.tanggal?e.tanggal:O()),[p,x]=r.useState(e!=null&&e.kode_transfer_barang?e.kode_transfer_barang:""),[t,c]=r.useState(e!=null&&e.daftar_gudang_asal?e.daftar_gudang_asal:""),[o,h]=r.useState(e!=null&&e.daftar_gudang_akhir?e.daftar_gudang_akhir:""),[v,w]=r.useState([]),[_,y]=r.useState([]),[m,b]=r.useState(),T=async()=>{await D()&&F.custom(`${e!=null&&e.uuid?`/${e.uuid}`:""}`,e?"PUT":"POST",null,{data:{tanggal:u,kode_transfer_barang:p,daftar_gudang_asal:t.value,daftar_gudang_akhir:o.value}}).then(s=>{e?(b(f=>e),S("Berhasil","Data berhasil diupdate")):(b(f=>s.data),S("Berhasil","Data berhasil disimpan"))}).catch(s=>{k(s)})};r.useEffect(()=>{const s=v.filter(f=>f.uuid!=t.value);y(s),s.length>0&&h({label:s[0].name,value:s[0].uuid})},[t]);const j=()=>{U.custom("","GET").then(s=>{if(w(f=>s.data.entry),s.data.entry.length>0){if(e){P({editObject:e.daftar_gudang_asal,dataList:s.data.entry,setState:c,labelKey:"name",valueKey:"uuid"}),P({editObject:e.daftar_gudang_akhir,dataList:s.data.entry,setState:h,labelKey:"name",valueKey:"uuid"});return}c({label:s.data.entry[0].name,value:s.data.entry[0].uuid})}})};return r.useEffect(()=>{j()},[]),a.jsx(a.Fragment,{children:a.jsxs("div",{className:"bg-white px-6 py-3 rounded-md shadow-2xl",children:[a.jsxs("div",{className:"mb-3 flex justify-between items-center",children:[a.jsxs("h1",{className:"uppercase text-gray-600 font-bold",children:[e?"Edit":"Tambahkan"," Transfer Barang"]}),a.jsxs("button",{className:"btn btn-sm bg-red-900 text-white border-none",onClick:()=>{n(),d()},children:[a.jsx($,{})," Batalkan Transfer Barang"]})]}),a.jsxs("div",{className:"flex gap-x-2",children:[a.jsx(A,{label:"Tanggal Transfer Barang",type:"datetime-local",onchange:s=>{g(s.target.value)},others:{value:u,disabled:m,tanggal:"tanggalTransferBarang"}}),a.jsx(A,{label:"Kode Transfer Barang",type:"text",onchange:s=>{x(s.target.value)},others:{value:p,disabled:m,tanggal:"kodeTransferBarang"}}),a.jsx(R,{label:"Gudang Asal",optionsDataList:_,optionsLabel:"name",optionsValue:"uuid",selectValue:t,disabled:m,onchange:s=>{c(s)},selectName:"gudangAsalTransferBarang"}),a.jsx(R,{label:"Gudang Akhir",optionsDataList:_,optionsLabel:"name",optionsValue:"uuid",selectValue:o,disabled:m,onchange:s=>{h(s)},selectName:"gudangAkhirTransferBarang"})]}),m?a.jsx(a.Fragment,{children:a.jsx(B,{transferBarang:m})}):a.jsx(a.Fragment,{children:a.jsxs("button",{className:"btn btn-sm bg-green-800 mt-4 text-white",onClick:()=>{T()},children:[a.jsx(G,{})," Simpan"]})}),e&&!m?a.jsx(a.Fragment,{children:a.jsx(B,{transferBarang:e,preview:!0})}):a.jsx(a.Fragment,{})]})})},ra=V.forwardRef((d,e)=>{var n;return a.jsxs("div",{ref:e,children:[a.jsx(sa,{bulan:d.bulan,tahun:d.tahun,title:"Transfer Barang"}),a.jsxs("table",{className:"table",children:[a.jsx("thead",{children:a.jsxs("tr",{className:"sticky top-0 bg-white py-4 text-black",children:[a.jsx("th",{width:12,children:"No"}),a.jsx("th",{children:"Nama Transfer Barang"})]})}),a.jsx("tbody",{children:(n=d==null?void 0:d.data)==null?void 0:n.map((u,g)=>a.jsx(a.Fragment,{children:a.jsxs("tr",{children:[a.jsx("td",{children:g+1}),a.jsx("td",{children:u.name})]},g)}))})]})]})}),fa=()=>{const d=I(),{data:e}=d,[n,u]=r.useState([]),[g,p]=r.useState(!1),[x,t]=r.useState(!1),[c,o]=r.useState({name:""}),[h,v]=r.useState(!1),[w,_]=r.useState(""),y=r.useRef(),m=na.useReactToPrint({content:()=>y.current}),[b,T]=r.useState({page:1,size:10,count:118,lastPage:12}),j=(i="")=>{i==""&&_(i),p(!0),F.custom(`?search=${i}&page=${b.page}&size=${b.size}&tahun=${e.tahun}`,"GET").then(l=>{var N,C;v(i.length<1),u((N=l==null?void 0:l.data)==null?void 0:N.entry),T((C=l==null?void 0:l.data)==null?void 0:C.pagination),p(!1)}).catch(l=>{k(l)})},s=i=>{let l=n[i];o(l),t(!x)},f=async i=>{if(await Q("Hapus","Yakin ingin hapus data ini ?")){let l=n[i];F.custom(`/${l.uuid}`,"DELETE").then(()=>{S("Berhasil","Data berhasil dihapus"),j()}).catch(N=>{k(N)})}},z=({selected:i})=>{let l=b;l.page=i+1,T(l),j()},K=i=>{let l=b;l.size=i,l.page=1,T(l),j()};return r.useEffect(()=>{j()},[]),a.jsx(Z,{isLoading:g,children:a.jsxs("div",{children:[a.jsx(X,{title:"Transfer Barang"}),x?a.jsx(la,{setAddTransferBarangEvent:()=>t(!1),getData:j,transferBarangEdit:c}):a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"bg-white py-3 px-6 mb-3 rounded-md flex justify-between shadow-2xl",children:[a.jsxs("label",{className:"input input-sm input-bordered flex items-center gap-2 bg-white",children:[a.jsx("input",{type:"text",className:"grow bg-transparent",placeholder:"Cari",value:w,onChange:i=>_(i.target.value)}),h?a.jsx(W,{onClick:()=>{j(w)},className:"cursor-pointer"}):a.jsx($,{onClick:()=>j(""),className:"cursor-pointer"})]}),a.jsxs("div",{className:"flex gap-x-2 items-center",children:[a.jsxs("button",{className:"btn btn-sm bg-blue-900 text-white border-none",onClick:()=>{o(null),t(!x)},children:[a.jsx(H,{})," Tambah Transfer Barang"]}),a.jsx("div",{className:"hidden",children:a.jsx(ra,{data:n,ref:y,bulan:J(new Date().getMonth()),tahun:e.tahun})}),a.jsxs("button",{onClick:m,className:"btn btn-sm bg-red-600 hover:bg-red-600 text-white border-red-600",children:[a.jsx(q,{})," Cetak Transfer Barang"]})]})]}),a.jsx("div",{className:"overflow-x-auto bg-white shadow-xl rounded-md h-[50vh] no-scrollbar px-6 pb-4",children:a.jsxs("table",{className:"table",children:[a.jsx("thead",{children:a.jsxs("tr",{className:"sticky top-0 bg-white py-4 text-black",children:[a.jsx("th",{width:12,children:"No"}),a.jsx("th",{children:"Tanggal"}),a.jsx("th",{children:"Kode"}),a.jsx("th",{children:"Gudang Asal"}),a.jsx("th",{children:"Gudang Akhir"}),a.jsx("th",{children:"Aksi"})]})}),a.jsx("tbody",{children:n==null?void 0:n.map((i,l)=>a.jsx(a.Fragment,{children:a.jsxs("tr",{children:[a.jsxs("td",{children:[l+1,"."]}),a.jsx("td",{children:i.tanggal}),a.jsx("td",{children:i.kode_transfer_barang}),a.jsx("td",{children:i.daftar_gudang_asal_name}),a.jsx("td",{children:i.daftar_gudang_akhir_name}),a.jsxs("td",{className:"flex gap-x-2",children:[a.jsx(M,{size:12,className:"text-yellow-500 cursor-pointer",onClick:()=>{s(l)}}),a.jsx(Y,{size:12,className:"text-red-500 cursor-pointer",onClick:()=>{f(l)}})]})]},l)}))})]})}),a.jsx(E,{paginateUpdatePage:z,paginate:b,setSize:K})]})]})})};export{fa as default};
