import{j as a,r as l,F as aa,d as ea,e as P,h as W,k as q,aJ as H,s as v,A as z,O as sa,b as O,aK as I,u as ta,o as la,q as U,n as V}from"./index-CBiC-3z3.js";import{P as na}from"./PageTitle-B0c32fKm.js";import{i as R,F as ia,g as C,W as ra}from"./Wrap-BkENrgtl.js";import{B as ca}from"./BulanSelectedListCard-DvNVxkNo.js";import{D as oa}from"./DebetKreditStatusCard-0iFgHAP8.js";import{p as N,a as E}from"./number.helper-_FlTjox4.js";import{K as da}from"./KasRowData-B4i4jfOy.js";import{F as B}from"./FormInputWithLabel-CG72YFWb.js";import{i as J}from"./actionEvent.helper-CSfRBgS8.js";import{F as G}from"./FormSelectWithLabel-BwIvOt7G.js";import{F as M}from"./FormInput-CmrfS47c.js";import{b as ua}from"./jurnalUmum.helper-7Gejmxnn.js";import{C as xa}from"./CheckListBox-Bz6qRoNF.js";const ma=({item:r,deleteItem:c=()=>{},editItem:b=()=>{},deleteByBuktiTransaksi:p=()=>{},balanceStatus:o=!0,forPrint:u=!1})=>a.jsxs("div",{className:`flex flex-col w-full bg-white text-[13px] px-3 ${u?"":"shadow-md"}`,children:[a.jsx("div",{className:"grid grid-cols-12 sticky top-0 bg-white py-2 border-b-2",children:a.jsxs("div",{className:"p-2 col-span-9 text-black flex items-end",children:[a.jsx("div",{className:"text-[28px] font-bold",children:o?a.jsx("p",{className:`text-[45px] -ml-1 text-white px-2 rounded-md ${r.total.debet==r.total.kredit?"bg-green-900":"bg-red-900"}`,children:parseFloat(r.tanggal)<10?`0${r.tanggal}`:r.tanggal}):a.jsx("p",{className:"text-[45px] -ml-1 text-white px-2 rounded-md bg-green-900",children:parseFloat(r.tanggal)<10?`0${r.tanggal}`:r.tanggal})}),a.jsx("div",{className:"flex flex-col",children:a.jsxs("div",{className:"flex items-end",children:[a.jsxs("div",{className:"text-gray-900 flex flex-col justify-end px-2",children:[a.jsxs("h1",{children:[r.bulan,".",r.tahun]}),a.jsx("h2",{className:"text-[13px] font-bold",children:r.hari})]}),a.jsxs("div",{className:"flex flex-col px-2 border-l-2 border-gray-600",children:[a.jsx("h1",{className:"font-bold",children:"Total"}),a.jsxs("div",{className:"flex gap-x-4",children:[a.jsx("div",{className:"text-right",children:a.jsx("h1",{className:" text-green-900 font-bold flex flex-row",children:N(r.total.debet)})}),a.jsx("div",{className:"text-right",children:a.jsx("h1",{className:" text-red-900 font-bold",children:N(r.total.kredit)})})]})]})]})})]})}),r.buktiTransaksi.map(x=>a.jsx(a.Fragment,{children:a.jsx(da,{deleteByBuktiTransaksi:p,deleteItem:c,editItem:b,forPrint:u,item1:x,balanceStatus:o})}))]}),ha=({idTransaksiKas:r,nilaiTransaksi:c=0,type:b=1})=>{const[p,o]=l.useState(!1),[u,x]=l.useState({totalDebet:b==1?c:0,totalKredit:b==0?c:0}),[k,F]=l.useState([]),[f,T]=l.useState([]),[n,g]=l.useState([{waktu:`${new Date().getHours()<10?"0"+new Date().getHours():new Date().getHours()}:${new Date().getMinutes()<10?"0"+new Date().getMinutes():new Date().getMinutes()}:${new Date().getSeconds()<10?"0"+new Date().getSeconds():new Date().getSeconds()}`,kodeAkun:R(),uraian:"",nilai:"0"}]),y=t=>{let e=[...n],s=[...f];e[t].uuid&&s.push(e[t]),T(i=>s),g(i=>[]),e.splice(t,1),g(e)},A=async()=>{await q()&&(j(0),D(0))},D=async t=>{f[t]&&(o(e=>!0),H.custom(`/${f[t].uuid}`,"DELETE").then(()=>{o(e=>!1),D(t+=1)}).catch(e=>{v(e)}))},j=async t=>{n[t]&&(o(e=>!0),H.custom(n[t].uuid?`/${n[t].uuid}`:"",n[t].uuid?"PUT":"POST",null,{data:{kode_akun_perkiraan:n[t].kodeAkun.value,waktu:n[t].waktu,transaksi_kas:r,uraian:n[t].uraian,nilai:n[t].nilai}}).then(e=>{n[t].uuid||(n[t].uuid=e.data.uuid),o(s=>!1),j(t+=1)}).catch(e=>{v(e)}))},$=()=>{let t=[...n];t.push({waktu:`${new Date().getHours()<10?"0"+new Date().getHours():new Date().getHours()}:${new Date().getMinutes()<10?"0"+new Date().getMinutes():new Date().getMinutes()}:${new Date().getSeconds()<10?"0"+new Date().getSeconds():new Date().getSeconds()}`,kodeAkun:R(),uraian:"",nilai:"0"}),g(e=>t)},S=()=>{let t=0;n.map(e=>{t+=E(e.nilai)}),x(e=>({totalDebet:b==0?t:c,totalKredit:b==1?t:c}))},w=(t,e,s)=>{let i=[...n];g(K=>[]),i[e][s]=t,g(K=>i)};l.useEffect(()=>{S()},[n]);const L=t=>{z.custom("/no_kas","GET").then(e=>{F(s=>e.data)})},_=()=>{H.custom(`/${r}`,"GET").then(t=>{g(e=>t.data.map(s=>{const i=k.filter(K=>K.uuid==s.kode_akun_perkiraan).at(0);return i?{uuid:s.uuid,nilai:N(s.nilai),waktu:s.waktu,uraian:s.uraian,kodeAkun:{label:`${i.code} - ${i.name}`,value:s.kode_akun_perkiraan}}:{uuid:s.uuid,nilai:N(s.nilai),waktu:s.waktu,uraian:s.uraian,kodeAkun:R()}}))}).catch(t=>{v(t)})};return l.useEffect(()=>{_()},[k]),l.useEffect(()=>{L()},[]),a.jsx(a.Fragment,{children:a.jsxs("div",{className:"flex flex-col px-6 mt-6 w-full",children:[a.jsxs("div",{className:"grid grid-cols-7 w-max gap-x-2 items-center",children:[a.jsx("div",{className:"col-span-1",children:a.jsx("label",{className:"form-control w-full bg-white",children:a.jsx("div",{className:"label",children:a.jsx("span",{className:"label-text font-bold",children:"Debet"})})})}),a.jsx("div",{className:"col-span-3",children:a.jsx("label",{className:"form-control w-full bg-white",children:a.jsx("div",{className:"label",children:a.jsx("span",{className:"label-text font-bold",children:"Kredit"})})})}),a.jsx("div",{className:"col-span-3",children:a.jsx("label",{className:"form-control w-full bg-white",children:a.jsx("div",{className:"label",children:a.jsx("span",{className:"label-text font-bold",children:"Status"})})})}),a.jsx("div",{className:"col-span-1",children:a.jsx("label",{className:"form-control w-full bg-white",children:a.jsx("div",{className:"label",children:a.jsx("span",{className:"label-text",children:N(u.totalDebet)})})})}),a.jsx("div",{className:"col-span-3",children:a.jsx("label",{className:"form-control w-full bg-white",children:a.jsx("div",{className:"label",children:a.jsx("span",{className:"label-text",children:N(u.totalKredit)})})})}),a.jsx("div",{className:"col-span-3",children:a.jsx("label",{className:"form-control w-full bg-white",children:a.jsx("div",{className:"label",children:a.jsx("span",{className:`label-text font-bold text-white px-3 py-2 rounded-md ${E(u.totalDebet)==E(u.totalKredit)?"bg-green-600":"bg-red-600"}`,children:E(u.totalDebet)==E(u.totalKredit)?"Seimbang":"Tidak Seimbang"})})})})]}),a.jsx("label",{className:"form-control w-full max-w-xs bg-white",children:a.jsx("div",{className:"label",children:a.jsx("span",{className:"flex items-center gap-x-2 label-text text-gray-800 font-bold mt-4",children:a.jsx("p",{children:"Rincian Transaksi Kas"})})})}),a.jsxs("div",{className:"grid w-full grid-cols-12 gap-x-2 border-b-2",children:[a.jsx("div",{className:"col-span-1",children:a.jsx("label",{className:"form-control w-full max-w-xs bg-white",children:a.jsx("div",{className:"label",children:a.jsx("span",{className:"label-text text-gray-600",children:"Waktu"})})})}),a.jsx("div",{className:"col-span-3",children:a.jsx("label",{className:"form-control w-full max-w-xs bg-white",children:a.jsx("div",{className:"label",children:a.jsx("span",{className:"label-text text-gray-600",children:"Kode Akun"})})})}),a.jsx("div",{className:"col-span-6",children:a.jsx("label",{className:"form-control w-full max-w-xs bg-white",children:a.jsx("div",{className:"label",children:a.jsx("span",{className:"label-text text-gray-600",children:"Uraian"})})})}),a.jsx("div",{className:"col-span-2",children:a.jsx("label",{className:"form-control w-full max-w-xs bg-white",children:a.jsx("div",{className:"label",children:a.jsx("span",{className:"label-text text-gray-600",children:"Nilai"})})})})]}),a.jsx("div",{className:"grid w-full items-end grid-cols-12 gap-x-2",children:n.map((t,e)=>a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"mb-5 col-span-1",children:a.jsx(M,{name:`waktu_${e}`,type:"time",value:t.waktu,addClass:"required",onchange:s=>w(s.target.value,e,"waktu"),other:{autoComplete:!1,step:1}})}),a.jsx("div",{className:"mb-5 col-span-3",children:a.jsx(ia,{optionsDataList:k,optionsLabel:["code","name"],optionsValue:"uuid",optionsLabelIsArray:!0,optionsDelimiter:"-",selectValue:t.kodeAkun,onchange:s=>{w(s,e,"kodeAkun")},addClass:"required",selectName:`kodeAkun_${e}`})}),a.jsx("div",{className:"mb-5 col-span-6",children:a.jsx(M,{name:`uraian_${e}`,type:"text",value:t.uraian,addClass:"required",onchange:s=>w(s.target.value,e,"uraian"),other:{autoComplete:!1}})}),a.jsx("div",{className:"mb-5 col-span-2",children:a.jsxs("div",{className:"w-full indicator",children:[a.jsx("span",{className:"indicator-item indicator-bottom badge bg-red-800 text-white px-2 py-4 cursor-pointer",onClick:()=>y(e),children:a.jsx(aa,{})}),a.jsx(M,{name:`nilai_${e}`,type:"text",value:N(t.nilai),onchange:s=>{J(s),w(s.target.value,e,"nilai")},other:{autoComplete:!1}})]})})]}))}),a.jsxs("div",{className:"flex sticky bottom-0 bg-white py-3 w-full items-end gap-x-2",children:[ea("demo_permission")&&n.length<2?a.jsx(a.Fragment,{children:a.jsxs("button",{className:"btn btn-sm bg-blue-800 mt-4 text-white",onClick:()=>$(),children:[a.jsx(P,{})," Tambah Transaksi"]})}):a.jsx(a.Fragment,{children:a.jsx("p",{className:"text-red-500 font-bold text-xs",children:"* Hanya Mengijinkan 2 Inputan Dalam Mode Demo"})}),a.jsxs("button",{disabled:p,className:"btn btn-sm bg-green-800 mt-4 text-white",onClick:()=>A(),children:[a.jsx(W,{})," ",p?"Sedang Menyimpan":"Simpan"]})]})]})})},ga=({setAddTransaksiEvent:r,transaksiSelected:c})=>{const[b,p]=l.useState(!1),[o,u]=l.useState({label:C[0].label,value:C[0].value}),[x,k]=l.useState(null),[F,f]=l.useState(null),[T,n]=l.useState(sa()),[g,y]=l.useState(""),[A,D]=l.useState(""),[j,$]=l.useState("0"),[S,w]=l.useState([]),L=e=>{z.custom("/kas","GET").then(s=>{if(w(s.data),s.data.length>0)if(e){const i=s.data.filter(K=>K.uuid==e);i.length>0&&f({label:`${i[0].code} - ${i[0].name}`,value:i[0].uuid})}else f({label:`${s.data[0].code} - ${s.data[0].name}`,value:s.data[0].uuid})})},_=async e=>{e.preventDefault(),await q(e.target)&&(p(s=>!0),I.custom(`${c?"/"+c:""}`,c?"PUT":"POST",null,{data:{tanggal:T,bukti_transaksi:g,kode_akun_perkiraan:F.value,uraian:A,nilai:j,type:o.value}}).then(s=>{k(c||s.data.uuid),p(i=>!1)}).catch(s=>{v(s),p(i=>!1)}))},t=()=>{I.custom(`/${c}`).then(e=>{n(s=>e.data.tanggal),y(s=>e.data.bukti_transaksi),D(s=>e.data.uraian),$(s=>N(e.data.nilai)),u({label:C.filter(s=>s.value==e.data.type).at(0).label,value:e.data.type}),L(e.data.kode_akun_perkiraan)}).catch(e=>{v(e)})};return l.useEffect(()=>{c&&t()},[c]),l.useEffect(()=>{L()},[]),a.jsx(a.Fragment,{children:a.jsxs("div",{className:"bg-white rounded-md shadow-2xl h-[70vh] overflow-scroll no-scrollbar relative",children:[a.jsxs("div",{className:"sticky top-0 pt-3 px-6 h-max bg-white w-full z-10",children:[a.jsxs("div",{className:"mb-3 flex justify-between items-center",children:[a.jsxs("h1",{className:"uppercase text-gray-600 font-bold",children:[c!=null?"Edit ":"Tambah "," Transaksi"]}),a.jsxs("button",{className:"btn btn-sm bg-red-900 text-white border-none",onClick:()=>r(),children:[a.jsx(O,{})," Batalkan Transaksi"]})]}),a.jsxs("form",{onSubmit:e=>_(e),children:[a.jsxs("div",{className:"flex gap-x-2",children:[a.jsx(B,{label:"Hari/Tanggal",type:"datetime-local",onchange:e=>{n(e.target.value)},disabled:x,others:{value:T,name:"hariTanggal"}}),a.jsx(B,{label:"Bukti Transaksi",type:"text",disabled:x,onchange:e=>{y(e.target.value)},others:{value:g,name:"buktiTransaksi"}})]}),a.jsxs("div",{className:"mt-5 flex gap-x-2",children:[a.jsx(G,{label:"Tipe Transaksi",optionsDataList:C,optionsLabel:"label",disabled:x,optionsValue:"value",selectValue:o,onchange:e=>{u(e)},selectName:"tipeTransaksi"}),a.jsx(G,{label:"Kode Akun",optionsDataList:S,optionsLabel:["code","name"],optionsValue:"uuid",optionsLabelIsArray:!0,optionsDelimiter:"-",disabled:x,selectValue:F,onchange:e=>{f(e)},selectName:"kodeAkun"}),a.jsx(B,{label:"Uraian",type:"text",disabled:x,onchange:e=>{D(e.target.value)},others:{value:A,name:"uraian"}}),a.jsx(B,{label:"Nilai",type:"text",onchange:e=>{J(e),$(e.target.value)},disabled:x,others:{value:j,name:"nilai"}})]}),x?a.jsx(a.Fragment,{}):a.jsxs("button",{disabled:b,className:"btn btn-sm bg-green-800 mt-4 text-white",children:[a.jsx(W,{})," ",b?"Sedang Menyimpan":"Simpan"]})]})]}),x?a.jsx(a.Fragment,{children:a.jsx(ha,{kodeAkunList:S,idTransaksiKas:x,nilaiTransaksi:j,type:o.value})}):a.jsx(a.Fragment,{})]})})},Fa=()=>{const r=ta(),{data:c,setData:b}=r,[p,o]=l.useState(!1),[u,x]=l.useState(!0),[k,F]=l.useState(C.map(d=>d.value)),[f,T]=l.useState(""),[n,g]=l.useState(new Date().getMonth()),[y,A]=l.useState([]),[D,j]=l.useState([]),[$,S]=l.useState(),[w,L]=l.useState(0),[_,t]=l.useState(0),[e,s]=l.useState(!1),i=(d="")=>{o(!0),d==""&&T(d),I.custom(`/${n+1}/${c.tahun}?search=${d}`,"GET").then(async m=>{A(h=>m.data),o(!1)}).catch(m=>{v(m)})},K=async d=>{await U("Hapus","Yakin ingin hapus data ini ?")&&H.custom(`/${d}`,"DELETE").then(m=>{V("Berhasil","Transaksi berhasil dihapus"),i()}).catch(m=>{v(m),i()})},Y=async d=>{await U("Hapus","Yakin ingin hapus data di bukti transaksi ini ?")&&(o(!0),I.custom(`/${d.data[0][0].uuid}`,"DELETE").then(()=>{V("Berhasil","Transaksi berhasil dihapus"),i()}).catch(m=>{v(m),i()}))},Q=async d=>{o(!0),S(d.data[0][0].uuid),s(!0),o(!1)},X=async()=>{const d=y.filter(h=>k.filter(Z=>Z==h.type).length>0);let m=await ua(d.map(h=>(h.bulan=n+1,h.tahun=c.tahun,h.waktu=h.waktu?h.waktu:h.tanggal.split("T")[1].replace(".000",""),h.tanggal=h.tanggal.length>2?new Date(h.tanggal).getDate():h.tanggal,h)));j(m.returnData),L(m.totalDebet),t(m.totalKredit)};return l.useEffect(()=>{X()},[k,y]),l.useEffect(()=>{i()},[n]),l.useEffect(()=>{e||i()},[e]),l.useEffect(()=>{}),a.jsx(ra,{isLoading:p,children:a.jsx("div",{children:e?a.jsx(ga,{setAddTransaksiEvent:()=>s(!e),transaksiSelected:$}):a.jsxs(a.Fragment,{children:[a.jsx(na,{title:"Transaksi Kas"}),a.jsxs("div",{className:"bg-white py-3 px-6 mb-3 rounded-md flex justify-between shadow-2xl",children:[a.jsxs("label",{className:"input input-sm input-bordered flex items-center gap-2 bg-white",children:[a.jsx("input",{type:"text",className:"grow bg-transparent",placeholder:"Cari",value:f,onChange:d=>T(d.target.value)}),u?a.jsx(la,{className:"cursor-pointer",onClick:()=>i(f)}):a.jsx(O,{className:"cursor-pointer",onClick:()=>{i("")}})]}),a.jsx("div",{children:a.jsxs("button",{className:"btn btn-sm bg-blue-900 text-white border-none",onClick:()=>{S(null),s(!0)},children:[a.jsx(P,{})," Tambah Transaksi"]})})]}),a.jsxs("div",{className:"grid grid-cols-6",children:[a.jsxs("div",{className:"col-span-1",children:[a.jsx(ca,{bulan:n,setBulan:g}),u?a.jsx(oa,{debet:w,kredit:_}):a.jsx(a.Fragment,{})]}),a.jsx("div",{className:"col-span-5",children:a.jsxs("div",{className:"h-[65vh] pl-2",children:[a.jsx(xa,{checkListBox:k,setCheckListBox:F,checkListBoxList:C,label:"Tipe Transaksi"}),a.jsx("div",{className:"flex flex-col h-full overflow-y-scroll no-scrollbar w-full rounded-md",children:D.map((d,m)=>a.jsx(ma,{deleteByBuktiTransaksi:Y,deleteItem:K,editItem:Q,item:d,balanceStatus:u},m))})]})})]})]})})})};export{Fa as default};
