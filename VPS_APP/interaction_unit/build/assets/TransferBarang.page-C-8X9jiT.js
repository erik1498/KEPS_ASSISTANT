import{r,j as a,e as D,p as O,m as G,au as L,t as k,a7 as U,d as z,Q as P,o as V,av as S,v as F,aw as I,as as A,R as W,w as H,W as J,x as M,y as Q,l as Y,z as q,n as X,b as Z,F as E,D as aa}from"./index-Dz0IAc1t.js";import{P as ea}from"./Pagination-BmvIQq8E.js";import{F as R}from"./FormInputWithLabel-3H0YkeHW.js";import{i as ta}from"./actionEvent.helper-C3J6IymX.js";import{l as sa}from"./index-CLFgxKRx.js";import{P as na}from"./PDFHeader-DubrWhyn.js";import"./react-paginate-DtnFUk4C.js";import"./index-BKNjMPK8.js";const B=({transferBarang:i,preview:e})=>{const[n,o]=r.useState([]),j=()=>{L.custom(`/by_transfer_barang/${i.uuid}`).then(t=>{o(c=>t.data)}).catch(t=>k(t))},p=(t,c)=>{let h=n;h=h.map(u=>(u.stok_awal_barang==c&&(u.jumlah=t),u)),o(u=>h)},g=t=>{n[t].stok_awal_barang_tujuan?L.custom(n[t].uuid?`/${n[t].uuid}`:"",n[t].uuid?"PUT":"POST",null,{data:{transfer_barang:i.uuid,stok_awal_barang:n[t].stok_awal_barang,jumlah:n[t].jumlah,stok_awal_barang_tujuan:n[t].stok_awal_barang_tujuan}}).then(()=>{t<n.length&&g(t+1)}).catch(c=>k(c)):g(t+1)};return r.useEffect(()=>{j()},[i]),a.jsx(a.Fragment,{children:a.jsxs("div",{className:"my-5 bg-white py-5 rounded-md",children:[a.jsx("h1",{className:"text-xl font-extrabold w-max text-white px-2 rounded-md bg-blue-900 mb-4",children:"Daftar Barang"}),a.jsx("div",{className:"overflow-x-auto max-h-[40vh] h-max no-scrollbar pb-4",children:a.jsxs("table",{className:"table",children:[a.jsx("thead",{children:a.jsxs("tr",{className:"sticky top-0 z-50 bg-white py-4 text-black",children:[a.jsx("th",{width:12,children:"No"}),a.jsx("th",{children:"Nama Barang"}),a.jsx("th",{children:"Kode Barang"}),a.jsx("th",{children:"Satuan Barang"}),a.jsx("th",{width:150,children:"Jumlah"})]})}),a.jsx("tbody",{children:n==null?void 0:n.map((t,c)=>t.stok_awal_barang_tujuan&&a.jsx(a.Fragment,{children:a.jsxs("tr",{children:[a.jsxs("td",{children:[c+1,"."]}),a.jsx("td",{children:t.daftar_barang_nama_barang}),a.jsx("td",{children:t.kategori_harga_barang_kode_barang}),a.jsx("td",{children:t.satuan_barang}),a.jsx("td",{children:e?a.jsx(a.Fragment,{children:t.jumlah}):a.jsx(a.Fragment,{children:a.jsx(D,{name:"jumlah",type:"text",other:{defaultValue:t.jumlah},onchange:h=>{ta(h),p(h.target.value,t.stok_awal_barang)},value:O(t.jumlah)})})})]},c)}))})]})}),e?a.jsx(a.Fragment,{}):a.jsx(a.Fragment,{children:a.jsxs("button",{className:"btn btn-sm bg-green-800 mt-3 text-white",onClick:()=>{g(0)},children:[a.jsx(G,{})," Simpan"]})})]})})},la=({setAddTransferBarangEvent:i=()=>{},transferBarangEdit:e,getData:n=()=>{}})=>{const[o,j]=r.useState(e!=null&&e.tanggal?e.tanggal:U()),[p,g]=r.useState(e!=null&&e.kode_transfer_barang?e.kode_transfer_barang:""),[t,c]=r.useState(e!=null&&e.daftar_gudang_asal?e.daftar_gudang_asal:""),[h,u]=r.useState(e!=null&&e.daftar_gudang_akhir?e.daftar_gudang_akhir:""),[N,w]=r.useState([]),[_,y]=r.useState([]),[x,b]=r.useState(),T=async()=>{await V()&&S.custom(`${e!=null&&e.uuid?`/${e.uuid}`:""}`,e?"PUT":"POST",null,{data:{tanggal:o,kode_transfer_barang:p,daftar_gudang_asal:t.value,daftar_gudang_akhir:h.value}}).then(s=>{e?(b(f=>e),F("Berhasil","Data berhasil diupdate")):(b(f=>s.data),F("Berhasil","Data berhasil disimpan"))}).catch(s=>{k(s)})};r.useEffect(()=>{const s=N.filter(f=>f.uuid!=t.value);y(s),s.length>0&&u({label:s[0].name,value:s[0].uuid})},[t]);const m=()=>{I.custom("","GET").then(s=>{if(w(f=>s.data.entry),s.data.entry.length>0){if(e){A({editObject:e.daftar_gudang_asal,dataList:s.data.entry,setState:c,labelKey:"name",valueKey:"uuid"}),A({editObject:e.daftar_gudang_akhir,dataList:s.data.entry,setState:u,labelKey:"name",valueKey:"uuid"});return}c({label:s.data.entry[0].name,value:s.data.entry[0].uuid})}})};return r.useEffect(()=>{m()},[]),a.jsx(a.Fragment,{children:a.jsxs("div",{className:"bg-white px-6 py-3 rounded-md shadow-2xl",children:[a.jsxs("div",{className:"mb-3 flex justify-between items-center",children:[a.jsxs("h1",{className:"uppercase text-gray-600 font-bold",children:[e?"Edit":"Tambahkan"," Transfer Barang"]}),a.jsxs("button",{className:"btn btn-sm bg-red-900 text-white border-none",onClick:()=>{n(),i()},children:[a.jsx(z,{})," Batalkan Transfer Barang"]})]}),a.jsxs("div",{className:"flex gap-x-2",children:[a.jsx(R,{label:"Tanggal Transfer Barang",type:"datetime-local",onchange:s=>{j(s.target.value)},others:{value:o,disabled:x,tanggal:"tanggalTransferBarang"}}),a.jsx(R,{label:"Kode Transfer Barang",type:"text",onchange:s=>{g(s.target.value)},others:{value:p,disabled:x,tanggal:"kodeTransferBarang"}}),a.jsx(P,{label:"Gudang Asal",optionsDataList:_,optionsLabel:"name",optionsValue:"uuid",selectValue:t,disabled:x,onchange:s=>{c(s)},selectName:"gudangAsalTransferBarang"}),a.jsx(P,{label:"Gudang Akhir",optionsDataList:_,optionsLabel:"name",optionsValue:"uuid",selectValue:h,disabled:x,onchange:s=>{u(s)},selectName:"gudangAkhirTransferBarang"})]}),x?a.jsx(a.Fragment,{children:a.jsx(B,{transferBarang:x})}):a.jsx(a.Fragment,{children:a.jsxs("button",{className:"btn btn-sm bg-green-800 mt-4 text-white",onClick:()=>{T()},children:[a.jsx(G,{})," Simpan"]})}),e&&!x?a.jsx(a.Fragment,{children:a.jsx(B,{transferBarang:e,preview:!0})}):a.jsx(a.Fragment,{})]})})},ra=W.forwardRef((i,e)=>{var n;return a.jsxs("div",{ref:e,children:[a.jsx(na,{bulan:i.bulan,tahun:i.tahun,title:"Transfer Barang"}),a.jsxs("table",{className:"table",children:[a.jsx("thead",{children:a.jsxs("tr",{className:"sticky top-0 bg-white py-4 text-black",children:[a.jsx("th",{width:12,children:"No"}),a.jsx("th",{children:"Nama Transfer Barang"})]})}),a.jsx("tbody",{children:(n=i==null?void 0:i.data)==null?void 0:n.map((o,j)=>a.jsx(a.Fragment,{children:a.jsxs("tr",{children:[a.jsx("td",{children:j+1}),a.jsx("td",{children:o.name})]},j)}))})]})]})}),ma=()=>{const i=H(),{data:e}=i,[n,o]=r.useState([]),[j,p]=r.useState(!1),[g,t]=r.useState(!1),[c,h]=r.useState({name:""}),[u,N]=r.useState(!1),[w,_]=r.useState(""),y=r.useRef(),x=sa.useReactToPrint({content:()=>y.current}),[b,T]=r.useState({page:1,size:10,count:118,lastPage:12}),m=(d="")=>{d==""&&_(d),p(!0),S.custom(`?search=${d}&page=${b.page}&size=${b.size}&tahun=${e.tahun}`,"GET").then(l=>{var v,C;N(d.length<1),o((v=l==null?void 0:l.data)==null?void 0:v.entry),T((C=l==null?void 0:l.data)==null?void 0:C.pagination),p(!1)}).catch(l=>{k(l)})},s=d=>{let l=n[d];h(l),t(!g)},f=async d=>{if(await aa("Hapus","Yakin ingin hapus data ini ?")){let l=n[d];S.custom(`/${l.uuid}`,"DELETE").then(()=>{F("Berhasil","Data berhasil dihapus"),m()}).catch(v=>{k(v)})}},$=({selected:d})=>{let l=b;l.page=d+1,T(l),m()},K=d=>{let l=b;l.size=d,l.page=1,T(l),m()};return r.useEffect(()=>{m()},[]),a.jsx(J,{isLoading:j,children:a.jsxs("div",{children:[a.jsx(M,{title:"Transfer Barang"}),g?a.jsx(la,{setAddTransferBarangEvent:()=>t(!1),getData:m,transferBarangEdit:c}):a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"bg-white py-3 px-6 mb-3 rounded-md flex justify-between shadow-2xl",children:[a.jsxs("label",{className:"input input-sm input-bordered flex items-center gap-2 bg-white",children:[a.jsx("input",{type:"text",className:"grow bg-transparent",placeholder:"Cari",value:w,onChange:d=>_(d.target.value)}),u?a.jsx(Q,{onClick:()=>{m(w)},className:"cursor-pointer"}):a.jsx(z,{onClick:()=>m(""),className:"cursor-pointer"})]}),a.jsxs("div",{className:"flex gap-x-2 items-center",children:[a.jsxs("button",{className:"btn btn-sm bg-blue-900 text-white border-none",onClick:()=>{h(null),t(!g)},children:[a.jsx(Y,{})," Tambah Transfer Barang"]}),a.jsx("div",{className:"hidden",children:a.jsx(ra,{data:n,ref:y,bulan:q(new Date().getMonth()),tahun:e.tahun})}),a.jsxs("button",{onClick:x,className:"btn btn-sm bg-red-600 hover:bg-red-600 text-white border-red-600",children:[a.jsx(X,{})," Cetak Transfer Barang"]})]})]}),a.jsx("div",{className:"overflow-x-auto bg-white shadow-xl rounded-md h-[50vh] no-scrollbar px-6 pb-4",children:a.jsxs("table",{className:"table",children:[a.jsx("thead",{children:a.jsxs("tr",{className:"sticky top-0 bg-white py-4 text-black",children:[a.jsx("th",{width:12,children:"No"}),a.jsx("th",{children:"Tanggal"}),a.jsx("th",{children:"Kode"}),a.jsx("th",{children:"Gudang Asal"}),a.jsx("th",{children:"Gudang Akhir"}),a.jsx("th",{children:"Aksi"})]})}),a.jsx("tbody",{children:n==null?void 0:n.map((d,l)=>a.jsx(a.Fragment,{children:a.jsxs("tr",{children:[a.jsxs("td",{children:[l+1,"."]}),a.jsx("td",{children:d.tanggal}),a.jsx("td",{children:d.kode_transfer_barang}),a.jsx("td",{children:d.daftar_gudang_asal_name}),a.jsx("td",{children:d.daftar_gudang_akhir_name}),a.jsxs("td",{className:"flex gap-x-2",children:[a.jsx(Z,{size:12,className:"text-yellow-500 cursor-pointer",onClick:()=>{s(l)}}),a.jsx(E,{size:12,className:"text-red-500 cursor-pointer",onClick:()=>{f(l)}})]})]},l)}))})]})}),a.jsx(ea,{paginateUpdatePage:$,paginate:b,setSize:K})]})]})})};export{ma as default};
