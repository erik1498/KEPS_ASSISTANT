import{v as f}from"./index-BHalgDnS.js";import{g as o,a as b}from"./number.helper-efe0YCx6.js";const D=(e,i)=>{let s=[];return e=e.map(a=>(a.parent=a[i],s.includes(a.parent)||s.push(a.parent),a)),s.map(a=>{let u=e.filter(n=>n.parent==a);return{parent:a,data:u}})},w=(e,i)=>{let s=e;for(let r=0;r<s.length;r++){for(let a=0;a<i.length;a++)s[r][i[a]]=0;for(let a=0;a<s[r].data.length;a++)for(let u=0;u<i.length;u++)s[r][i[u]]+=s[r].data[a][i[u]]}return s},T=e=>{let i=[];return e=e.map(r=>(r.parent=r.tanggal.split("T")[0],i.includes(r.parent)||i.push(r.parent),r)),i.map(r=>{let a=e.filter(u=>u.parent==r);return{parent:r,data:a}})},S=e=>{let i=[],s=[],r=[];for(let a=0;a<e.length;a++){const u=e[a];u.sumber=="PERINTAH STOK OPNAME"&&!s.includes(u.transaksi)&&s.push(u.transaksi),u.sumber=="STOK AWAL BARANG"&&!r.includes(u.transaksi)&&r.push(u.transaksi)}return e.map((a,u)=>{const n=JSON.parse(a.detail_data);let t={uuid:a.uuid,bukti_transaksi:a.bukti_transaksi,sumber:a.sumber,tahun:a.tahun,bulan:a.bulan,tanggal:a.tanggal,waktu:a.waktu?a.waktu:a.tanggal.split("T")[1].replace(".000",""),transaksi:a.transaksi,uraian:a.uraian,kode_akun:a.kode_akun,type_akun:a.type_akun,nama_akun:a.nama_akun,debet:a.debet,kredit:a.kredit,saldoDebet:a.saldoDebet,saldoKredit:a.saldoKredit,detail_data:n};a.sumber=="PERINTAH STOK OPNAME"?s.includes(a.transaksi)&&(s[s.indexOf(a.transaksi)]=-1,t.satuan_barang_name=n.satuan_barang_name,t.faktur_penjualan_barang=n.faktur_penjualan_barang,t.kategori_harga_barang_kode_barang=n.kategori_harga_barang_kode_barang,t.pesanan_penjualan_barang=n.pesanan_penjualan_barang,t.customer_name=n.customer_name,t.customer_code=n.customer_code,t.daftar_gudang_name=n.daftar_gudang_name,t.daftar_barang_name=n.daftar_barang_name,t.jumlah=n.jumlah,t.harga=n.harga,t.ppn=n.ppn,t.diskon_persentase=n.diskon_persentase,t.waktu_show=!0):a.sumber=="STOK AWAL BARANG"?r.includes(a.transaksi)&&(r[r.indexOf(a.transaksi)]=-1,t.daftar_barang_name=n.daftar_barang_name,t.daftar_gudang_name=n.daftar_gudang_name,t.harga_beli=n.harga_beli,t.kategori_harga_barang_kode_barang=n.kategori_harga_barang_kode_barang,t.satuan_barang_name=n.satuan_barang_name,t.jumlah=n.jumlah,t.waktu_show=!0):a.transaksi==0&&(t.satuan_barang_name=n.satuan_barang_name,t.faktur_penjualan_barang=n.faktur_penjualan_barang,t.kategori_harga_barang_kode_barang=n.kategori_harga_barang_kode_barang,t.pesanan_penjualan_barang=n.pesanan_penjualan_barang,t.customer_name=n.customer_name,t.customer_code=n.customer_code,t.daftar_gudang_name=n.daftar_gudang_name,t.daftar_barang_name=n.daftar_barang_name,t.jumlah=n.jumlah,t.harga=n.harga,t.ppn=n.ppn,t.diskon_persentase=n.diskon_persentase,t.waktu_show=!0),i.push(t)}),i.filter(a=>String(parseFloat(a.debet).toFixed(2))!="0.00"||String(parseFloat(a.kredit).toFixed(2))!="0.00").map(a=>(a.tanggal=`${a.tanggal.length}`>2?new Date(`${a.tanggal}`).getDate():a.tanggal,a.waktu=a.waktu==a.tanggal?a.waktu.split("T")[1].replace(".000",""):a.waktu,a))},h=e=>{let i=Math.max(...e.map(r=>r.transaksi)),s=[];for(let r=0;r<=i;r++)s.push([...e.filter(a=>a.transaksi==r)]);return s},j=e=>new Promise((i,s)=>{let r=0,a=0;try{r=o(e.map(t=>t.debet)),a=o(e.map(t=>t.kredit))}catch{r=0,a=0}let u=[],n="00";e.map(t=>{t.tanggal!=n&&(n=t.tanggal,u[`${parseInt(n)}`]={total:{kredit:0,debet:0},tanggal:t.tanggal,bulan:t.bulan,tahun:t.tahun,hari:f[new Date(`${t.tahun}-${t.bulan}-${n}`).getDay()]});let l=e.filter(k=>k.tanggal==n);u[`${parseInt(n)}`].total={debet:l.reduce((k,_)=>k+b(_.debet),0),kredit:l.reduce((k,_)=>k+b(_.kredit),0)};let d=[],g=[];l.map(k=>{d.indexOf(k.bukti_transaksi)<0&&(d.push(k.bukti_transaksi),g.push({bukti_transaksi:k.bukti_transaksi,data:h(l.filter(_=>_.bukti_transaksi==k.bukti_transaksi)),debet:o(l.filter(_=>_.bukti_transaksi==k.bukti_transaksi).map(_=>_.debet)),kredit:o(l.filter(_=>_.bukti_transaksi==k.bukti_transaksi).map(_=>_.kredit)),tanggal:k.tanggal,bulan:k.bulan,tahun:k.tahun,sumber:k.sumber}))}),u[`${parseInt(n)}`].buktiTransaksi=g}),i({totalDebet:r,totalKredit:a,returnData:u})}),O=(e,i,s)=>new Promise((r,a)=>{let u=[];i!=null&&i.transaksiList.forEach((l,d)=>{l.concat(s).map(g=>{let k="DELETE",_=e.transaksiList[d]!=null?e.transaksiList[d].filter(p=>p.uuid==g.uuid):[];_.length>0&&(k="PUT",g=_[0]),g.uuid&&u.push({tanggal:new Date(e.hariTanggal).getDate().toString(),bulan:(new Date(e.hariTanggal).getMonth()+1).toString(),tahun:new Date(e.hariTanggal).getFullYear().toString(),waktu:g.waktu,uraian:g.uraian,debet:g.debet.toString(),kredit:g.kredit.toString(),kode_akun_uuid:g.kodeAkun.value,bukti_transaksi:e.buktiTransaksi,transaksi:d,uuid:g.uuid,status:k})})}),e.transaksiList.forEach((l,d)=>{l.forEach(g=>{g.uuid||u.push({tanggal:new Date(e.hariTanggal).getDate().toString(),bulan:(new Date(e.hariTanggal).getMonth()+1).toString(),tahun:new Date(e.hariTanggal).getFullYear().toString(),waktu:g.waktu,uraian:g.uraian,debet:g.debet.toString(),kredit:g.kredit.toString(),kode_akun_uuid:g.kodeAkun.value,bukti_transaksi:e.buktiTransaksi,status:"POST",transaksi:d})})});let n=[],t=[];u.map(l=>{l.status!="POST"&&t.indexOf(l.uuid)<0&&(n.push(l),t.push(l.uuid))}),n=n.concat(u.filter(l=>l.status=="POST")),r(n)}),A=(e,i)=>new Promise((s,r)=>{let a=[];e.forEach((u,n)=>{a[n]=[],u.forEach(t=>{a[n].push({waktu:t.waktu,kodeAkun:{label:`${t.kode_akun} - ${t.nama_akun}`,value:i.filter(l=>l.code==t.kode_akun)[0].uuid},uraian:t.uraian,debet:t.debet,kredit:t.kredit,uuid:t.uuid})})}),s(a)});export{S as a,j as b,A as c,D as d,w as e,T as g,O as n};
