import{v as h}from"./index-CBiC-3z3.js";import{g as o,a as b}from"./number.helper-_FlTjox4.js";const D=e=>{let k=[];return e=e.map(r=>(r.parent=r.tanggal.split("T")[0],k.includes(r.parent)||k.push(r.parent),r)),k.map(r=>{let t=e.filter(u=>u.parent==r);return{parent:r,data:t}})},w=e=>{let k=[],_=[],r=[];for(let t=0;t<e.length;t++){const u=e[t];u.sumber=="PERINTAH STOK OPNAME"&&!_.includes(u.transaksi)&&_.push(u.transaksi),u.sumber=="STOK AWAL BARANG"&&!r.includes(u.transaksi)&&r.push(u.transaksi)}return e.map((t,u)=>{const n=JSON.parse(t.detail_data);let a={uuid:t.uuid,bukti_transaksi:t.bukti_transaksi,sumber:t.sumber,tahun:t.tahun,bulan:t.bulan,tanggal:t.tanggal,waktu:t.waktu?t.waktu:t.tanggal.split("T")[1].replace(".000",""),transaksi:t.transaksi,uraian:t.uraian,kode_akun:t.kode_akun,type_akun:t.type_akun,nama_akun:t.nama_akun,debet:t.debet,kredit:t.kredit,saldoDebet:t.saldoDebet,saldoKredit:t.saldoKredit,detail_data:n};t.sumber=="PERINTAH STOK OPNAME"?_.includes(t.transaksi)&&(_[_.indexOf(t.transaksi)]=-1,a.satuan_barang_name=n.satuan_barang_name,a.faktur_penjualan_barang=n.faktur_penjualan_barang,a.kategori_harga_barang_kode_barang=n.kategori_harga_barang_kode_barang,a.pesanan_penjualan_barang=n.pesanan_penjualan_barang,a.customer_name=n.customer_name,a.customer_code=n.customer_code,a.daftar_gudang_name=n.daftar_gudang_name,a.daftar_barang_name=n.daftar_barang_name,a.jumlah=n.jumlah,a.harga=n.harga,a.ppn=n.ppn,a.diskon_persentase=n.diskon_persentase,a.waktu_show=!0):t.sumber=="STOK AWAL BARANG"?r.includes(t.transaksi)&&(r[r.indexOf(t.transaksi)]=-1,a.daftar_barang_name=n.daftar_barang_name,a.daftar_gudang_name=n.daftar_gudang_name,a.harga_beli=n.harga_beli,a.kategori_harga_barang_kode_barang=n.kategori_harga_barang_kode_barang,a.satuan_barang_name=n.satuan_barang_name,a.jumlah=n.jumlah,a.waktu_show=!0):t.transaksi==0&&(a.satuan_barang_name=n.satuan_barang_name,a.faktur_penjualan_barang=n.faktur_penjualan_barang,a.kategori_harga_barang_kode_barang=n.kategori_harga_barang_kode_barang,a.pesanan_penjualan_barang=n.pesanan_penjualan_barang,a.customer_name=n.customer_name,a.customer_code=n.customer_code,a.daftar_gudang_name=n.daftar_gudang_name,a.daftar_barang_name=n.daftar_barang_name,a.jumlah=n.jumlah,a.harga=n.harga,a.ppn=n.ppn,a.diskon_persentase=n.diskon_persentase,a.waktu_show=!0),k.push(a)}),k.filter(t=>String(parseFloat(t.debet).toFixed(2))!="0.00"||String(parseFloat(t.kredit).toFixed(2))!="0.00").map(t=>(t.tanggal=`${t.tanggal.length}`>2?new Date(`${t.tanggal}`).getDate():t.tanggal,t.waktu=t.waktu==t.tanggal?t.waktu.split("T")[1].replace(".000",""):t.waktu,t))},f=e=>{let k=Math.max(...e.map(r=>r.transaksi)),_=[];for(let r=0;r<=k;r++)_.push([...e.filter(t=>t.transaksi==r)]);return _},T=e=>new Promise((k,_)=>{let r=0,t=0;try{r=o(e.map(a=>a.debet)),t=o(e.map(a=>a.kredit))}catch{r=0,t=0}let u=[],n="00";e.map(a=>{a.tanggal!=n&&(n=a.tanggal,u[`${parseInt(n)}`]={total:{kredit:0,debet:0},tanggal:a.tanggal,bulan:a.bulan,tahun:a.tahun,hari:h[new Date(`${a.tahun}-${a.bulan}-${n}`).getDay()]});let s=e.filter(g=>g.tanggal==n);u[`${parseInt(n)}`].total={debet:s.reduce((g,l)=>g+b(l.debet),0),kredit:s.reduce((g,l)=>g+b(l.kredit),0)};let d=[],i=[];s.map(g=>{d.indexOf(g.bukti_transaksi)<0&&(d.push(g.bukti_transaksi),i.push({bukti_transaksi:g.bukti_transaksi,data:f(s.filter(l=>l.bukti_transaksi==g.bukti_transaksi)),debet:o(s.filter(l=>l.bukti_transaksi==g.bukti_transaksi).map(l=>l.debet)),kredit:o(s.filter(l=>l.bukti_transaksi==g.bukti_transaksi).map(l=>l.kredit)),tanggal:g.tanggal,bulan:g.bulan,tahun:g.tahun,sumber:g.sumber}))}),u[`${parseInt(n)}`].buktiTransaksi=i}),k({totalDebet:r,totalKredit:t,returnData:u})}),S=(e,k,_)=>new Promise((r,t)=>{let u=[];k!=null&&k.transaksiList.forEach((s,d)=>{s.concat(_).map(i=>{let g="DELETE",l=e.transaksiList[d]!=null?e.transaksiList[d].filter(p=>p.uuid==i.uuid):[];l.length>0&&(g="PUT",i=l[0]),i.uuid&&u.push({tanggal:new Date(e.hariTanggal).getDate().toString(),bulan:(new Date(e.hariTanggal).getMonth()+1).toString(),tahun:new Date(e.hariTanggal).getFullYear().toString(),waktu:i.waktu,uraian:i.uraian,debet:i.debet.toString(),kredit:i.kredit.toString(),kode_akun_uuid:i.kodeAkun.value,bukti_transaksi:e.buktiTransaksi,transaksi:d,uuid:i.uuid,status:g})})}),e.transaksiList.forEach((s,d)=>{s.forEach(i=>{i.uuid||u.push({tanggal:new Date(e.hariTanggal).getDate().toString(),bulan:(new Date(e.hariTanggal).getMonth()+1).toString(),tahun:new Date(e.hariTanggal).getFullYear().toString(),waktu:i.waktu,uraian:i.uraian,debet:i.debet.toString(),kredit:i.kredit.toString(),kode_akun_uuid:i.kodeAkun.value,bukti_transaksi:e.buktiTransaksi,status:"POST",transaksi:d})})});let n=[],a=[];u.map(s=>{s.status!="POST"&&a.indexOf(s.uuid)<0&&(n.push(s),a.push(s.uuid))}),n=n.concat(u.filter(s=>s.status=="POST")),r(n)}),j=(e,k)=>new Promise((_,r)=>{let t=[];e.forEach((u,n)=>{t[n]=[],u.forEach(a=>{t[n].push({waktu:a.waktu,kodeAkun:{label:`${a.kode_akun} - ${a.nama_akun}`,value:k.filter(s=>s.code==a.kode_akun)[0].uuid},uraian:a.uraian,debet:a.debet,kredit:a.kredit,uuid:a.uuid})})}),_(t)});export{w as a,T as b,j as c,D as g,S as n};
