import{j as a,r as l,F as aa,d as ea,e as W,h as q,k as z,aU as I,s as T,A as O,O as sa,b as Y,aV as R,u as ta,o as la,q as V,n as G}from"./index-BFtBgOrg.js";import{P as na}from"./PageTitle-Hc-YSVDI.js";import{i as M,F as ia,l as _,W as ra}from"./Wrap-Dk-wg8kL.js";import{B as ca}from"./BulanSelectedListCard-CzSL4UYq.js";import{D as oa}from"./DebetKreditStatusCard-DwH7rgo0.js";import{p as v,a as B}from"./number.helper-efe0YCx6.js";import{K as da}from"./KasRowData-63Ch1hYf.js";import{F as H}from"./FormInputWithLabel-zEsdZ3IQ.js";import{i as J}from"./actionEvent.helper-BujKUZ7B.js";import{F as P}from"./FormSelectWithLabel-BuQTQxHx.js";import{F as U}from"./FormInput-DctP6iug.js";import{b as ua}from"./jurnalUmum.helper-caEROVYd.js";import{C as xa}from"./CheckListBox-DRTxlLms.js";const ma=({item:i,deleteItem:r=()=>{},editItem:y=()=>{},deleteByBuktiTransaksi:p=()=>{},balanceStatus:d=!0,forPrint:u=!1})=>a.jsxs("div",{className:`flex flex-col w-full bg-white text-[13px] px-3 ${u?"":"shadow-md"}`,children:[a.jsx("div",{className:"grid grid-cols-12 sticky top-0 bg-white py-2 border-b-2",children:a.jsxs("div",{className:"p-2 col-span-9 text-black flex items-end",children:[a.jsx("div",{className:"text-[28px] font-bold",children:d?a.jsx("p",{className:`text-[45px] -ml-1 text-white px-2 rounded-md ${i.total.debet==i.total.kredit?"bg-green-900":"bg-red-900"}`,children:parseFloat(i.tanggal)<10?`0${i.tanggal}`:i.tanggal}):a.jsx("p",{className:"text-[45px] -ml-1 text-white px-2 rounded-md bg-green-900",children:parseFloat(i.tanggal)<10?`0${i.tanggal}`:i.tanggal})}),a.jsx("div",{className:"flex flex-col",children:a.jsxs("div",{className:"flex items-end",children:[a.jsxs("div",{className:"text-gray-900 flex flex-col justify-end px-2",children:[a.jsxs("h1",{children:[i.bulan,".",i.tahun]}),a.jsx("h2",{className:"text-[13px] font-bold",children:i.hari})]}),a.jsxs("div",{className:"flex flex-col px-2 border-l-2 border-gray-600",children:[a.jsx("h1",{className:"font-bold",children:"Total"}),a.jsxs("div",{className:"flex gap-x-4",children:[a.jsx("div",{className:"text-right",children:a.jsx("h1",{className:" text-green-900 font-bold flex flex-row",children:v(i.total.debet)})}),a.jsx("div",{className:"text-right",children:a.jsx("h1",{className:" text-red-900 font-bold",children:v(i.total.kredit)})})]})]})]})})]})}),i.buktiTransaksi.map(g=>a.jsx(a.Fragment,{children:a.jsx(da,{deleteByBuktiTransaksi:p,deleteItem:r,editItem:y,forPrint:u,item1:g,balanceStatus:d})}))]}),ha=({idTransaksiKas:i,nilaiTransaksi:r=0,getData:y=()=>{},type:p=1})=>{const[d,u]=l.useState(!1),[g,x]=l.useState({totalDebet:p==1?r:0,totalKredit:p==0?r:0}),[j,D]=l.useState([]),[k,f]=l.useState([]),[n,b]=l.useState([{waktu:`${new Date().getHours()<10?"0"+new Date().getHours():new Date().getHours()}:${new Date().getMinutes()<10?"0"+new Date().getMinutes():new Date().getMinutes()}:${new Date().getSeconds()<10?"0"+new Date().getSeconds():new Date().getSeconds()}`,kodeAkun:M(),uraian:"",nilai:"0"}]),A=t=>{let e=[...n],s=[...k];e[t].uuid&&s.push(e[t]),f(c=>s),b(c=>[]),e.splice(t,1),b(e)},$=async()=>{await z()&&(w(0),S(0))},S=async t=>{k[t]?(u(e=>!0),I.custom(`/${k[t].uuid}`,"DELETE").then(()=>{u(e=>!1),S(t+=1)}).catch(e=>{T(e)})):y()},w=async t=>{n[t]?(u(e=>!0),I.custom(n[t].uuid?`/${n[t].uuid}`:"",n[t].uuid?"PUT":"POST",null,{data:{kode_akun_perkiraan:n[t].kodeAkun.value,waktu:n[t].waktu,transaksi_kas:i,uraian:n[t].uraian,nilai:n[t].nilai}}).then(e=>{n[t].uuid||(n[t].uuid=e.data.uuid),u(s=>!1),w(t+=1)}).catch(e=>{T(e)})):y()},K=()=>{let t=[...n];t.push({waktu:`${new Date().getHours()<10?"0"+new Date().getHours():new Date().getHours()}:${new Date().getMinutes()<10?"0"+new Date().getMinutes():new Date().getMinutes()}:${new Date().getSeconds()<10?"0"+new Date().getSeconds():new Date().getSeconds()}`,kodeAkun:M(),uraian:"",nilai:"0"}),b(e=>t)},L=()=>{let t=0;n.map(e=>{t+=B(e.nilai)}),x(e=>({totalDebet:p==0?t:r,totalKredit:p==1?t:r}))},N=(t,e,s)=>{let c=[...n];b(F=>[]),c[e][s]=t,b(F=>c)};l.useEffect(()=>{L()},[n]);const C=t=>{O.custom("/no_kas","GET").then(e=>{D(s=>e.data)})},E=()=>{I.custom(`/${i}`,"GET").then(t=>{b(e=>t.data.map(s=>{const c=j.filter(F=>F.uuid==s.kode_akun_perkiraan).at(0);return c?{uuid:s.uuid,nilai:v(s.nilai),waktu:s.waktu,uraian:s.uraian,kodeAkun:{label:`${c.code} - ${c.name}`,value:s.kode_akun_perkiraan}}:{uuid:s.uuid,nilai:v(s.nilai),waktu:s.waktu,uraian:s.uraian,kodeAkun:M()}}))}).catch(t=>{T(t)})};return l.useEffect(()=>{E()},[j]),l.useEffect(()=>{C()},[]),a.jsx(a.Fragment,{children:a.jsxs("div",{className:"flex flex-col px-6 mt-6 w-full",children:[a.jsxs("div",{className:"grid grid-cols-7 w-max gap-x-2 items-center",children:[a.jsx("div",{className:"col-span-1",children:a.jsx("label",{className:"form-control w-full bg-white",children:a.jsx("div",{className:"label",children:a.jsx("span",{className:"label-text font-bold",children:"Debet"})})})}),a.jsx("div",{className:"col-span-3",children:a.jsx("label",{className:"form-control w-full bg-white",children:a.jsx("div",{className:"label",children:a.jsx("span",{className:"label-text font-bold",children:"Kredit"})})})}),a.jsx("div",{className:"col-span-3",children:a.jsx("label",{className:"form-control w-full bg-white",children:a.jsx("div",{className:"label",children:a.jsx("span",{className:"label-text font-bold",children:"Status"})})})}),a.jsx("div",{className:"col-span-1",children:a.jsx("label",{className:"form-control w-full bg-white",children:a.jsx("div",{className:"label",children:a.jsx("span",{className:"label-text",children:v(g.totalDebet)})})})}),a.jsx("div",{className:"col-span-3",children:a.jsx("label",{className:"form-control w-full bg-white",children:a.jsx("div",{className:"label",children:a.jsx("span",{className:"label-text",children:v(g.totalKredit)})})})}),a.jsx("div",{className:"col-span-3",children:a.jsx("label",{className:"form-control w-full bg-white",children:a.jsx("div",{className:"label",children:a.jsx("span",{className:`label-text font-bold text-white px-3 py-2 rounded-md ${B(g.totalDebet)==B(g.totalKredit)?"bg-green-600":"bg-red-600"}`,children:B(g.totalDebet)==B(g.totalKredit)?"Seimbang":"Tidak Seimbang"})})})})]}),a.jsx("label",{className:"form-control w-full max-w-xs bg-white",children:a.jsx("div",{className:"label",children:a.jsx("span",{className:"flex items-center gap-x-2 label-text text-gray-800 font-bold mt-4",children:a.jsx("p",{children:"Rincian Transaksi Kas"})})})}),a.jsxs("div",{className:"grid w-full grid-cols-12 gap-x-2 border-b-2",children:[a.jsx("div",{className:"col-span-1",children:a.jsx("label",{className:"form-control w-full max-w-xs bg-white",children:a.jsx("div",{className:"label",children:a.jsx("span",{className:"label-text text-gray-600",children:"Waktu"})})})}),a.jsx("div",{className:"col-span-3",children:a.jsx("label",{className:"form-control w-full max-w-xs bg-white",children:a.jsx("div",{className:"label",children:a.jsx("span",{className:"label-text text-gray-600",children:"Kode Akun"})})})}),a.jsx("div",{className:"col-span-6",children:a.jsx("label",{className:"form-control w-full max-w-xs bg-white",children:a.jsx("div",{className:"label",children:a.jsx("span",{className:"label-text text-gray-600",children:"Uraian"})})})}),a.jsx("div",{className:"col-span-2",children:a.jsx("label",{className:"form-control w-full max-w-xs bg-white",children:a.jsx("div",{className:"label",children:a.jsx("span",{className:"label-text text-gray-600",children:"Nilai"})})})})]}),a.jsx("div",{className:"grid w-full items-end grid-cols-12 gap-x-2",children:n.map((t,e)=>a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"mb-5 col-span-1",children:a.jsx(U,{name:`waktu_${e}`,type:"time",value:t.waktu,addClass:"required",onchange:s=>N(s.target.value,e,"waktu"),other:{autoComplete:!1,step:1}})}),a.jsx("div",{className:"mb-5 col-span-3",children:a.jsx(ia,{optionsDataList:j,optionsLabel:["code","name"],optionsValue:"uuid",optionsLabelIsArray:!0,optionsDelimiter:"-",selectValue:t.kodeAkun,onchange:s=>{N(s,e,"kodeAkun")},addClass:"required",selectName:`kodeAkun_${e}`})}),a.jsx("div",{className:"mb-5 col-span-6",children:a.jsx(U,{name:`uraian_${e}`,type:"text",value:t.uraian,addClass:"required",onchange:s=>N(s.target.value,e,"uraian"),other:{autoComplete:!1}})}),a.jsx("div",{className:"mb-5 col-span-2",children:a.jsxs("div",{className:"w-full indicator",children:[a.jsx("span",{className:"indicator-item indicator-bottom badge bg-red-800 text-white px-2 py-4 cursor-pointer",onClick:()=>A(e),children:a.jsx(aa,{})}),a.jsx(U,{name:`nilai_${e}`,type:"text",value:v(t.nilai),onchange:s=>{J(s),N(s.target.value,e,"nilai")},other:{autoComplete:!1}})]})})]}))}),a.jsxs("div",{className:"flex sticky bottom-0 bg-white py-3 w-full items-end gap-x-2",children:[ea("demo_permission")&&n.length<2?a.jsx(a.Fragment,{children:a.jsxs("button",{className:"btn btn-sm bg-blue-800 mt-4 text-white",onClick:()=>K(),children:[a.jsx(W,{})," Tambah Transaksi"]})}):a.jsx(a.Fragment,{children:a.jsx("p",{className:"text-red-500 font-bold text-xs",children:"* Hanya Mengijinkan 2 Inputan Dalam Mode Demo"})}),a.jsxs("button",{disabled:d,className:"btn btn-sm bg-green-800 mt-4 text-white",onClick:()=>$(),children:[a.jsx(q,{})," ",d?"Sedang Menyimpan":"Simpan"]})]})]})})},ga=({setAddTransaksiEvent:i,transaksiSelected:r,getData:y=()=>{}})=>{const[p,d]=l.useState(!1),[u,g]=l.useState({label:_[0].label,value:_[0].value}),[x,j]=l.useState(null),[D,k]=l.useState(null),[f,n]=l.useState(sa()),[b,A]=l.useState(""),[$,S]=l.useState(""),[w,K]=l.useState("0"),[L,N]=l.useState([]),C=e=>{O.custom("/kas","GET").then(s=>{if(N(s.data),s.data.length>0)if(e){const c=s.data.filter(F=>F.uuid==e);c.length>0&&k({label:`${c[0].code} - ${c[0].name}`,value:c[0].uuid})}else k({label:`${s.data[0].code} - ${s.data[0].name}`,value:s.data[0].uuid})})},E=async e=>{e.preventDefault(),await z(e.target)&&(d(s=>!0),R.custom(`${r?"/"+r:""}`,r?"PUT":"POST",null,{data:{tanggal:f,bukti_transaksi:b,kode_akun_perkiraan:D.value,uraian:$,nilai:w,type:u.value}}).then(s=>{j(r||s.data.uuid),d(c=>!1)}).catch(s=>{T(s),d(c=>!1)}))},t=()=>{R.custom(`/${r}`).then(e=>{n(s=>e.data.tanggal),A(s=>e.data.bukti_transaksi),S(s=>e.data.uraian),K(s=>v(e.data.nilai)),g({label:_.filter(s=>s.value==e.data.type).at(0).label,value:e.data.type}),C(e.data.kode_akun_perkiraan)}).catch(e=>{T(e)})};return l.useEffect(()=>{r&&t()},[r]),l.useEffect(()=>{C()},[]),a.jsx(a.Fragment,{children:a.jsxs("div",{className:"bg-white rounded-md shadow-2xl no-scrollbar relative",children:[a.jsxs("div",{className:"sticky top-0 pt-3 px-6 h-max bg-white w-full z-10",children:[a.jsxs("div",{className:"mb-3 flex justify-between items-center",children:[a.jsxs("h1",{className:"uppercase text-gray-600 font-bold",children:[r!=null?"Edit ":"Tambah "," Transaksi"]}),a.jsxs("button",{className:"btn btn-sm bg-red-900 text-white border-none",onClick:()=>i(),children:[a.jsx(Y,{})," Batalkan Transaksi"]})]}),a.jsxs("form",{onSubmit:e=>E(e),children:[a.jsxs("div",{className:"flex gap-x-2",children:[a.jsx(H,{label:"Hari/Tanggal",type:"datetime-local",onchange:e=>{n(e.target.value)},disabled:x,others:{value:f,name:"hariTanggal"}}),a.jsx(H,{label:"Bukti Transaksi",type:"text",disabled:x,onchange:e=>{A(e.target.value)},others:{value:b,name:"buktiTransaksi"}})]}),a.jsxs("div",{className:"mt-5 flex gap-x-2",children:[a.jsx(P,{label:"Tipe Transaksi",optionsDataList:_,optionsLabel:"label",disabled:x,optionsValue:"value",selectValue:u,onchange:e=>{g(e)},selectName:"tipeTransaksi"}),a.jsx(P,{label:"Kode Akun",optionsDataList:L,optionsLabel:["code","name"],optionsValue:"uuid",optionsLabelIsArray:!0,optionsDelimiter:"-",disabled:x,selectValue:D,onchange:e=>{k(e)},selectName:"kodeAkun"}),a.jsx(H,{label:"Uraian",type:"text",disabled:x,onchange:e=>{S(e.target.value)},others:{value:$,name:"uraian"}}),a.jsx(H,{label:"Nilai",type:"text",onchange:e=>{J(e),K(e.target.value)},disabled:x,others:{value:w,name:"nilai"}})]}),x?a.jsx(a.Fragment,{}):a.jsxs("button",{disabled:p,className:"btn btn-sm bg-green-800 mt-4 text-white",children:[a.jsx(q,{})," ",p?"Sedang Menyimpan":"Simpan"]})]})]}),x?a.jsx(a.Fragment,{children:a.jsx(ha,{getData:y,kodeAkunList:L,idTransaksiKas:x,nilaiTransaksi:w,type:u.value})}):a.jsx(a.Fragment,{})]})})},Fa=()=>{const i=ta(),{data:r,setData:y}=i,[p,d]=l.useState(!1),[u,g]=l.useState(!0),[x,j]=l.useState(_.map(o=>o.value)),[D,k]=l.useState(""),[f,n]=l.useState(new Date().getMonth()),[b,A]=l.useState([]),[$,S]=l.useState([]),[w,K]=l.useState(),[L,N]=l.useState(0),[C,E]=l.useState(0),[t,e]=l.useState(!1),s=(o="")=>{d(!0),o==""&&k(o),R.custom(`/${f+1}/${r.tahun}?search=${o}`,"GET").then(async m=>{A(h=>m.data),d(!1)}).catch(m=>{T(m)})},c=async o=>{await V("Hapus","Yakin ingin hapus data ini ?")&&I.custom(`/${o}`,"DELETE").then(m=>{G("Berhasil","Transaksi berhasil dihapus"),s()}).catch(m=>{T(m),s()})},F=async o=>{await V("Hapus","Yakin ingin hapus data di bukti transaksi ini ?")&&(d(!0),R.custom(`/${o.data[0][0].uuid}`,"DELETE").then(()=>{G("Berhasil","Transaksi berhasil dihapus"),s()}).catch(m=>{T(m),s()}))},Q=async o=>{d(!0),K(o.data[0][0].uuid),e(!0),d(!1)},X=async()=>{const o=b.filter(h=>x.filter(Z=>Z==h.type).length>0);let m=await ua(o.map(h=>(h.bulan=f+1,h.tahun=r.tahun,h.waktu=h.waktu?h.waktu:h.tanggal.split("T")[1].replace(".000",""),h.tanggal=h.tanggal.length>2?new Date(h.tanggal).getDate():h.tanggal,h)));S(m.returnData),N(m.totalDebet),E(m.totalKredit)};return l.useEffect(()=>{X()},[x,b]),l.useEffect(()=>{s()},[f]),l.useEffect(()=>{t||s()},[t]),a.jsx(ra,{isLoading:p,children:a.jsx("div",{children:t?a.jsx(ga,{setAddTransaksiEvent:()=>e(!t),transaksiSelected:w,getData:s}):a.jsxs(a.Fragment,{children:[a.jsx(na,{title:"Transaksi Kas"}),a.jsxs("div",{className:"bg-white py-3 px-6 mb-3 rounded-md flex justify-between shadow-2xl",children:[a.jsxs("label",{className:"input input-sm input-bordered flex items-center gap-2 bg-white",children:[a.jsx("input",{type:"text",className:"grow bg-transparent",placeholder:"Cari",value:D,onChange:o=>k(o.target.value)}),u?a.jsx(la,{className:"cursor-pointer",onClick:()=>s(D)}):a.jsx(Y,{className:"cursor-pointer",onClick:()=>{s("")}})]}),a.jsx("div",{children:a.jsxs("button",{className:"btn btn-sm bg-blue-900 text-white border-none",onClick:()=>{K(null),e(!0)},children:[a.jsx(W,{})," Tambah Transaksi"]})})]}),a.jsxs("div",{className:"grid grid-cols-6",children:[a.jsxs("div",{className:"col-span-1",children:[a.jsx(ca,{bulan:f,setBulan:n}),u?a.jsx(oa,{debet:L,kredit:C}):a.jsx(a.Fragment,{})]}),a.jsx("div",{className:"col-span-5",children:a.jsxs("div",{className:"h-[65vh] pl-2",children:[a.jsx(xa,{checkListBox:x,setCheckListBox:j,checkListBoxList:_,label:"Tipe Transaksi"}),a.jsx("div",{className:"flex flex-col h-full overflow-y-scroll no-scrollbar w-full rounded-md",children:$.map((o,m)=>a.jsx(ma,{deleteByBuktiTransaksi:F,deleteItem:c,editItem:Q,item:o,balanceStatus:u},m))})]})})]})]})})})};export{Fa as default};
