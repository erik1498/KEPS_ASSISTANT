import{u as H,r,O as L,j as a,b as O,h as R,bt as F,s as f,bs as T,R as B,o as $,f as z,p as K,a as A,F as G,q as I,n as U}from"./index-CBiC-3z3.js";import{e as W,W as E}from"./Wrap-BkENrgtl.js";import{P as V}from"./Pagination-Bor55BAY.js";import{F as q}from"./FormInputWithLabel-CG72YFWb.js";import{F as D}from"./FormSelectWithLabel-BwIvOt7G.js";import{F as J}from"./FormInput-CmrfS47c.js";import{p as Y}from"./number.helper-_FlTjox4.js";import{i as M}from"./actionEvent.helper-CSfRBgS8.js";import{P as Q,l as X}from"./PDFHeader-LWmUPkCD.js";import{P as Z}from"./PageTitle-B0c32fKm.js";import"./index-BKNjMPK8.js";const aa=({setAddHasilStokOpnameEvent:i=()=>{},hasilStokOpnameEdit:n,getData:o=()=>{}})=>{const m=H(),{data:x}=m,[p,S]=r.useState(n!=null&&n.hasil_stok_opname_tanggal?n.hasil_stok_opname_tanggal:L()),[d,j]=r.useState(n!=null&&n.uuid?n.uuid:""),[y,N]=r.useState([]),[l,b]=r.useState([]),_=async t=>{F.custom(`${l[t].uuid!=""?`/${l[t].uuid}`:""}`,l[t].uuid!=""?"PUT":"POST",null,{data:{tanggal:p,perintah_stok_opname:d.value,stok_awal_barang:l[t].stok_awal_barang,kuantitas:`${l[t].kuantitas}`}}).then(()=>{t+1<l.length?_(t+1):(o(),i())}).catch(c=>{f(c)})},v=()=>{T.custom(`?tahun=${x.tahun}`,"GET").then(t=>{if(N(t.data.entry),t.data.entry.length>0){if(n){W({editObject:n.uuid,dataList:t.data.entry,setState:j,labelKey:"nomor_surat_perintah",valueKey:"uuid"});return}j({label:t.data.entry[0].nomor_surat_perintah,value:t.data.entry[0].uuid})}}).catch(t=>f(t))},u=()=>{F.custom(`/daftar_barang/${d.value}`,"GET").then(t=>{b(t.data)}).catch(t=>f(t))},k=(t,c)=>{let h=l;h=h.map(g=>(g.stok_awal_barang==c&&(g.kuantitas=t),g)),b(g=>h)};return r.useEffect(()=>{d&&u()},[d]),r.useEffect(()=>{v()},[]),a.jsx(a.Fragment,{children:a.jsxs("div",{className:"bg-white px-6 py-3 rounded-md shadow-2xl",children:[a.jsxs("div",{className:"mb-3 flex justify-between items-center",children:[a.jsxs("h1",{className:"uppercase text-gray-600 font-bold",children:[n?"Edit":"Tambahkan"," Hasil Stok Opname"]}),a.jsxs("button",{className:"btn btn-sm bg-red-900 text-white border-none",onClick:()=>i(),children:[a.jsx(O,{})," Batalkan Hasil Stok Opname"]})]}),a.jsxs("div",{className:"flex gap-x-2",children:[a.jsx(q,{label:"Tanggal",type:"datetime-local",onchange:t=>{S(t.target.value)},others:{value:p,name:"tanggal"}}),a.jsx(D,{label:"Perintah Stok Opname",optionsDataList:y,optionsLabel:"nomor_surat_perintah",optionsValue:"uuid",disabled:!0,selectValue:d,onchange:t=>{j(t)},selectName:"perintahStokOpname"})]}),a.jsx("div",{className:"overflow-x-auto rounded-md h-max max-h-[90vh] no-scrollbar mt-5 pb-4",children:a.jsxs("table",{className:"table",children:[a.jsx("thead",{children:a.jsxs("tr",{className:"sticky top-0 bg-white py-4 text-black",children:[a.jsx("th",{width:12,children:"No"}),a.jsx("th",{children:"Kode Barang"}),a.jsx("th",{children:"Nama Barang"}),a.jsx("th",{children:"Satuan Barang"}),a.jsx("th",{children:"Kuantitas"})]})}),a.jsx("tbody",{children:l==null?void 0:l.map((t,c)=>a.jsx(a.Fragment,{children:a.jsxs("tr",{children:[a.jsxs("td",{children:[c+1,"."]}),a.jsx("td",{children:t.kategori_harga_barang_kode_barang}),a.jsx("td",{children:t.daftar_barang_name}),a.jsx("td",{children:t.satuan_barang_name}),a.jsx("td",{children:a.jsx(J,{name:"kuantitas_"+c,type:"text",other:{defaultValue:t.kuantitas},onchange:h=>{M(h),k(h.target.value,t.stok_awal_barang)},value:Y(t.kuantitas)})})]},c)}))})]})}),a.jsxs("button",{className:"btn btn-sm bg-green-800 mt-4 text-white",onClick:()=>{_(0)},children:[a.jsx(R,{})," Simpan"]})]})})};B.forwardRef((i,n)=>{var o;return a.jsxs("div",{ref:n,children:[a.jsx(Q,{bulan:i.bulan,tahun:i.tahun,title:"Hasil Stok Opname"}),a.jsxs("table",{className:"table",children:[a.jsx("thead",{children:a.jsxs("tr",{className:"sticky top-0 bg-white py-4 text-black",children:[a.jsx("th",{width:12,children:"No"}),a.jsx("th",{children:"Nama Hasil Stok Opname"})]})}),a.jsx("tbody",{children:(o=i==null?void 0:i.data)==null?void 0:o.map((m,x)=>a.jsx(a.Fragment,{children:a.jsxs("tr",{children:[a.jsx("td",{children:x+1}),a.jsx("td",{children:m.name})]},x)}))})]})]})});const ua=()=>{const i=H(),{data:n}=i,[o,m]=r.useState([]),[x,p]=r.useState(!1),[S,d]=r.useState(!1),[j,y]=r.useState({name:""}),[N,l]=r.useState(!1),[b,_]=r.useState(""),v=r.useRef();X.useReactToPrint({content:()=>v.current});const[u,k]=r.useState({page:1,size:10,count:118,lastPage:12}),t=(s="")=>{s==""&&_(s),p(!0),T.custom(`?search=${s}&page=${u.page}&size=${u.size}&tahun=${n.tahun}`,"GET").then(e=>{var w,P;l(s.length<1),m((w=e==null?void 0:e.data)==null?void 0:w.entry),k((P=e==null?void 0:e.data)==null?void 0:P.pagination),p(!1)}).catch(e=>{f(e)})},c=s=>{let e=o[s];y(e),d(!S)},h=async s=>{if(await I("Hapus","Yakin ingin hapus data ini ?")){let e=o[s];F.custom(`/${e.uuid}`,"DELETE").then(()=>{U("Berhasil","Data berhasil dihapus"),t()}).catch(w=>{f(w)})}},g=({selected:s})=>{let e=u;e.page=s+1,k(e),t()},C=s=>{let e=u;e.size=s,e.page=1,k(e),t()};return r.useEffect(()=>{t()},[]),a.jsx(E,{isLoading:x,children:a.jsxs("div",{children:[a.jsx(Z,{title:"Hasil Stok Opname"}),S?a.jsx(aa,{setAddHasilStokOpnameEvent:()=>d(!1),getData:t,hasilStokOpnameEdit:j}):a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"bg-white py-3 px-6 mb-3 rounded-md flex justify-between shadow-2xl",children:a.jsxs("label",{className:"input input-sm input-bordered flex items-center gap-2 bg-white",children:[a.jsx("input",{type:"text",className:"grow bg-transparent",placeholder:"Cari",value:b,onChange:s=>_(s.target.value)}),N?a.jsx($,{onClick:()=>{t(b)},className:"cursor-pointer"}):a.jsx(O,{onClick:()=>t(""),className:"cursor-pointer"})]})}),a.jsx("div",{className:"overflow-x-auto bg-white shadow-xl rounded-md h-[50vh] no-scrollbar px-6 pb-4",children:a.jsxs("table",{className:"table",children:[a.jsx("thead",{children:a.jsxs("tr",{className:"sticky top-0 bg-white py-4 text-black",children:[a.jsx("th",{width:12,children:"No"}),a.jsx("th",{children:"Tanggal"}),a.jsx("th",{children:"Bulan Transaksi"}),a.jsx("th",{children:"Nomor Perintah Stok Opname"}),a.jsx("th",{children:"Pegawai Penanggung Jawab"}),a.jsx("th",{children:"Pegawai Pelaksana"}),a.jsx("th",{children:"Kategori Barang"}),a.jsx("th",{children:"Gudang Asal"}),a.jsx("th",{children:"Aksi"})]})}),a.jsx("tbody",{children:o==null?void 0:o.map((s,e)=>a.jsx(a.Fragment,{children:a.jsxs("tr",{children:[a.jsxs("td",{children:[e+1,"."]}),a.jsx("td",{children:z(s.hasil_stok_opname_tanggal,!0)}),a.jsx("td",{children:K(s.bulan_transaksi-1)}),a.jsx("td",{children:s.nomor_surat_perintah}),a.jsx("td",{children:s.pegawai_penanggung_jawab_name}),a.jsx("td",{children:s.pegawai_pelaksana_name}),a.jsx("td",{children:s.kategori_barang_name}),a.jsx("td",{children:s.daftar_gudang_name}),a.jsxs("td",{className:"flex gap-x-2",children:[a.jsx(A,{size:12,className:"text-yellow-500 cursor-pointer",onClick:()=>{c(e)}}),s.hasil_stok_opname_count>0?a.jsx(a.Fragment,{children:a.jsx(G,{size:12,className:"text-red-500 cursor-pointer",onClick:()=>{h(e)}})}):a.jsx(a.Fragment,{})]})]},e)}))})]})}),a.jsx(V,{paginateUpdatePage:g,paginate:u,setSize:C})]})]})})};export{ua as default};
