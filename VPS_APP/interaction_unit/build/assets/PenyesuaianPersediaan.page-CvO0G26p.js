import{u as C,r as i,O as L,j as a,b as O,h as R,bt as F,s as P,br as $,R as B,o as I,f as z,p as A,a as K,F as G,q as U,n as E}from"./index-QngEOzN_.js";import{e as W,W as H}from"./Wrap-BCfnb039.js";import{P as J}from"./Pagination-D3WNYDRv.js";import{F as V}from"./FormInputWithLabel-Bx4cKmcq.js";import{F as q}from"./FormSelectWithLabel-BCV4i4Bv.js";import{F as D}from"./FormInput-D113t21y.js";import{p as Y}from"./number.helper-_FlTjox4.js";import{P as M,l as Q}from"./PDFHeader-2lYxv13s.js";import{P as X}from"./PageTitle-ByHsc4p5.js";import"./index-BKNjMPK8.js";const Z=({setAddPenyesuaianPersediaanEvent:l=()=>{},penyesuaianPersediaanEdit:r,getData:c=()=>{}})=>{const m=C(),{data:x}=m,[j,y]=i.useState(r!=null&&r.penyesuaian_persediaan_tanggal?r.penyesuaian_persediaan_tanggal:L()),[d,b]=i.useState(r!=null&&r.uuid?r.uuid:""),[w,N]=i.useState([]),[n,_]=i.useState([]),k=async e=>{F.custom(`${n[e].uuid!=""?`/${n[e].uuid}`:""}`,n[e].uuid!=""?"PUT":"POST",null,{data:{tanggal:j,perintah_stok_opname:d.value,hasil_stok_opname:n[e].hasil_stok_opname,kuantitas:`${n[e].kuantitas}`,stok_tersedia_sistem:`${n[e].stok_sistem}`,tipe_penyesuaian:`${n[e].tipe_penyesuaian}`,jumlah:`${o(n[e])}`,keterangan:n[e].keterangan}}).then(()=>{e+1<n.length?k(e+1):(c(),l())}).catch(h=>{P(h)})},v=()=>{$.custom(`?tahun=${x.tahun}`,"GET").then(e=>{if(N(e.data.entry),e.data.entry.length>0){if(r){W({editObject:r.uuid,dataList:e.data.entry,setState:b,labelKey:"nomor_surat_perintah",valueKey:"uuid"});return}b({label:e.data.entry[0].nomor_surat_perintah,value:e.data.entry[0].uuid})}}).catch(e=>P(e))},u=()=>{F.custom(`/daftar_barang/${d.value}`,"GET").then(e=>{_(e.data)}).catch(e=>P(e))},f=(e,h)=>{let g=n;g=g.map(p=>(p.stok_awal_barang==h&&(p.keterangan=e),p)),_(p=>g)},o=e=>e.tipe_penyesuaian!="SESUAI"?e.tipe_penyesuaian=="PENGURANGAN"?parseInt(e.stok_sistem)-parseInt(e.kuantitas):parseInt(e.kuantitas)-parseInt(e.stok_sistem):"0";return i.useEffect(()=>{d&&u()},[d]),i.useEffect(()=>{v()},[]),a.jsx(a.Fragment,{children:a.jsxs("div",{className:"bg-white px-6 py-3 rounded-md shadow-2xl",children:[a.jsxs("div",{className:"mb-3 flex justify-between items-center",children:[a.jsxs("h1",{className:"uppercase text-gray-600 font-bold",children:[r?"Edit":"Tambahkan"," Penyesuaian Persediaan"]}),a.jsxs("button",{className:"btn btn-sm bg-red-900 text-white border-none",onClick:()=>l(),children:[a.jsx(O,{})," Batalkan Penyesuaian Persediaan"]})]}),a.jsxs("div",{className:"flex gap-x-2",children:[a.jsx(V,{label:"Tanggal",type:"datetime-local",onchange:e=>{y(e.target.value)},others:{value:j,name:"tanggal"}}),a.jsx(q,{label:"Perintah Stok Opname",optionsDataList:w,optionsLabel:"nomor_surat_perintah",optionsValue:"uuid",disabled:!0,selectValue:d,onchange:e=>{b(e)},selectName:"perintahStokOpname"})]}),a.jsx("div",{className:"overflow-x-auto rounded-md h-max max-h-[90vh] no-scrollbar mt-5 pb-4",children:a.jsxs("table",{className:"table",children:[a.jsx("thead",{children:a.jsxs("tr",{className:"sticky top-0 bg-white py-4 text-black",children:[a.jsx("th",{width:12,children:"No"}),a.jsx("th",{children:"Kode Barang"}),a.jsx("th",{children:"Nama Barang"}),a.jsx("th",{children:"Satuan Barang"}),a.jsx("th",{children:"Stok Sistem"}),a.jsx("th",{children:"Kuantitas"}),a.jsx("th",{children:"Tipe Penyesuaian"}),a.jsx("th",{children:"Jumlah"}),a.jsx("th",{children:"Keterangan"})]})}),a.jsx("tbody",{children:n==null?void 0:n.map((e,h)=>a.jsx(a.Fragment,{children:a.jsxs("tr",{children:[a.jsxs("td",{children:[h+1,"."]}),a.jsx("td",{children:e.kategori_harga_barang_kode_barang}),a.jsx("td",{children:e.daftar_barang_name}),a.jsx("td",{children:e.satuan_barang_name}),a.jsx("td",{children:e.stok_sistem}),a.jsx("td",{children:e.kuantitas}),a.jsx("td",{children:e.tipe_penyesuaian}),a.jsx("td",{children:o(e)}),a.jsx("td",{children:a.jsx(D,{name:"keterangan_"+h,type:"text",other:{defaultValue:e.keterangan},onchange:g=>{f(g.target.value,e.stok_awal_barang)},value:Y(e.keterangan)})})]},h)}))})]})}),a.jsxs("button",{className:"btn btn-sm bg-green-800 mt-4 text-white",onClick:()=>{k(0)},children:[a.jsx(R,{})," Simpan"]})]})})};B.forwardRef((l,r)=>{var c;return a.jsxs("div",{ref:r,children:[a.jsx(M,{bulan:l.bulan,tahun:l.tahun,title:"Penyesuaian Persediaan"}),a.jsxs("table",{className:"table",children:[a.jsx("thead",{children:a.jsxs("tr",{className:"sticky top-0 bg-white py-4 text-black",children:[a.jsx("th",{width:12,children:"No"}),a.jsx("th",{children:"Nama Penyesuaian Persediaan"})]})}),a.jsx("tbody",{children:(c=l==null?void 0:l.data)==null?void 0:c.map((m,x)=>a.jsx(a.Fragment,{children:a.jsxs("tr",{children:[a.jsx("td",{children:x+1}),a.jsx("td",{children:m.name})]},x)}))})]})]})});const ha=()=>{const l=C(),{data:r}=l,[c,m]=i.useState([]),[x,j]=i.useState(!1),[y,d]=i.useState(!1),[b,w]=i.useState({name:""}),[N,n]=i.useState(!1),[_,k]=i.useState(""),v=i.useRef();Q.useReactToPrint({content:()=>v.current});const[u,f]=i.useState({page:1,size:10,count:118,lastPage:12}),o=(s="")=>{s==""&&k(s),j(!0),$.custom(`?search=${s}&page=${u.page}&size=${u.size}&tahun=${r.tahun}`,"GET").then(t=>{var S,T;n(s.length<1),m((S=t==null?void 0:t.data)==null?void 0:S.entry),f((T=t==null?void 0:t.data)==null?void 0:T.pagination),j(!1)}).catch(t=>{P(t)})},e=s=>{let t=c[s];w(t),d(!y)},h=async s=>{if(await U("Hapus","Yakin ingin hapus data ini ?")){let t=c[s];F.custom(`/${t.uuid}`,"DELETE").then(()=>{E("Berhasil","Data berhasil dihapus"),o()}).catch(S=>{P(S)})}},g=({selected:s})=>{let t=u;t.page=s+1,f(t),o()},p=s=>{let t=u;t.size=s,t.page=1,f(t),o()};return i.useEffect(()=>{o()},[]),a.jsx(H,{isLoading:x,children:a.jsxs("div",{children:[a.jsx(X,{title:"Penyesuaian Persediaan"}),y?a.jsx(Z,{setAddPenyesuaianPersediaanEvent:()=>d(!1),getData:o,penyesuaianPersediaanEdit:b}):a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"bg-white py-3 px-6 mb-3 rounded-md flex justify-between shadow-2xl",children:a.jsxs("label",{className:"input input-sm input-bordered flex items-center gap-2 bg-white",children:[a.jsx("input",{type:"text",className:"grow bg-transparent",placeholder:"Cari",value:_,onChange:s=>k(s.target.value)}),N?a.jsx(I,{onClick:()=>{o(_)},className:"cursor-pointer"}):a.jsx(O,{onClick:()=>o(""),className:"cursor-pointer"})]})}),a.jsx("div",{className:"overflow-x-auto bg-white shadow-xl rounded-md h-[50vh] no-scrollbar px-6 pb-4",children:a.jsxs("table",{className:"table",children:[a.jsx("thead",{children:a.jsxs("tr",{className:"sticky top-0 bg-white py-4 text-black",children:[a.jsx("th",{width:12,children:"No"}),a.jsx("th",{children:"Tanggal"}),a.jsx("th",{children:"Bulan Transaksi"}),a.jsx("th",{children:"Nomor Penyesuaian Persediaan"}),a.jsx("th",{children:"Pegawai Penanggung Jawab"}),a.jsx("th",{children:"Pegawai Pelaksana"}),a.jsx("th",{children:"Kategori Barang"}),a.jsx("th",{children:"Gudang Asal"}),a.jsx("th",{children:"Aksi"})]})}),a.jsx("tbody",{children:c==null?void 0:c.map((s,t)=>a.jsx(a.Fragment,{children:a.jsxs("tr",{children:[a.jsxs("td",{children:[t+1,"."]}),a.jsx("td",{children:z(s.penyesuaian_persediaan_tanggal,!0)}),a.jsx("td",{children:A(s.bulan_transaksi-1)}),a.jsx("td",{children:s.nomor_surat_perintah}),a.jsx("td",{children:s.pegawai_penanggung_jawab_name}),a.jsx("td",{children:s.pegawai_pelaksana_name}),a.jsx("td",{children:s.kategori_barang_name}),a.jsx("td",{children:s.daftar_gudang_name}),a.jsxs("td",{className:"flex gap-x-2",children:[a.jsx(K,{size:12,className:"text-yellow-500 cursor-pointer",onClick:()=>{e(t)}}),s.penyesuaian_persediaan_count>0?a.jsx(a.Fragment,{children:a.jsx(G,{size:12,className:"text-red-500 cursor-pointer",onClick:()=>{h(t)}})}):a.jsx(a.Fragment,{})]})]},t)}))})]})}),a.jsx(J,{paginateUpdatePage:g,paginate:u,setSize:p})]})]})})};export{ha as default};
