import{v as h}from"./index-DHco5UoW.js";import{g as o,a as b}from"./number.helper-_FlTjox4.js";const D=e=>{let g=[];return e=e.map(a=>(a.parent=a.tanggal.split("T")[0],g.includes(a.parent)||g.push(a.parent),a)),g.map(a=>{let l=e.filter(n=>n.parent==a);return{parent:a,data:l}})},w=e=>{let g=[],_=[];for(let a=0;a<e.length;a++){const l=e[a];l.sumber=="PERINTAH STOK OPNAME"&&!_.includes(l.transaksi)&&_.push(l.transaksi)}return e.map((a,l)=>{const n=JSON.parse(a.detail_data);let t={uuid:a.uuid,bukti_transaksi:a.bukti_transaksi,sumber:a.sumber,tahun:a.tahun,bulan:a.bulan,tanggal:a.tanggal,waktu:a.waktu?a.waktu:a.tanggal.split("T")[1].replace(".000",""),transaksi:a.transaksi,uraian:a.uraian,kode_akun:a.kode_akun,type_akun:a.type_akun,nama_akun:a.nama_akun,debet:a.debet,kredit:a.kredit,saldoDebet:a.saldoDebet,saldoKredit:a.saldoKredit,detail_data:n};a.sumber=="PERINTAH STOK OPNAME"?_.includes(a.transaksi)&&(_[_.indexOf(a.transaksi)]=-1,t.satuan_barang_name=n.satuan_barang_name,t.faktur_penjualan_barang=n.faktur_penjualan_barang,t.kategori_harga_barang_kode_barang=n.kategori_harga_barang_kode_barang,t.pesanan_penjualan_barang=n.pesanan_penjualan_barang,t.customer_name=n.customer_name,t.customer_code=n.customer_code,t.daftar_gudang_name=n.daftar_gudang_name,t.daftar_barang_name=n.daftar_barang_name,t.jumlah=n.jumlah,t.harga=n.harga,t.ppn=n.ppn,t.diskon_persentase=n.diskon_persentase,t.waktu_show=!0):a.transaksi==0&&(t.satuan_barang_name=n.satuan_barang_name,t.faktur_penjualan_barang=n.faktur_penjualan_barang,t.kategori_harga_barang_kode_barang=n.kategori_harga_barang_kode_barang,t.pesanan_penjualan_barang=n.pesanan_penjualan_barang,t.customer_name=n.customer_name,t.customer_code=n.customer_code,t.daftar_gudang_name=n.daftar_gudang_name,t.daftar_barang_name=n.daftar_barang_name,t.jumlah=n.jumlah,t.harga=n.harga,t.ppn=n.ppn,t.diskon_persentase=n.diskon_persentase,t.waktu_show=!0),g.push(t)}),g.filter(a=>String(parseFloat(a.debet).toFixed(2))!="0.00"||String(parseFloat(a.kredit).toFixed(2))!="0.00").map(a=>(a.tanggal=`${a.tanggal.length}`>2?new Date(`${a.tanggal}`).getDate():a.tanggal,a.waktu=a.waktu==a.tanggal?a.waktu.split("T")[1].replace(".000",""):a.waktu,a))},f=e=>{let g=Math.max(...e.map(a=>a.transaksi)),_=[];for(let a=0;a<=g;a++)_.push([...e.filter(l=>l.transaksi==a)]);return _},T=e=>new Promise((g,_)=>{let a=0,l=0;try{a=o(e.map(r=>r.debet)),l=o(e.map(r=>r.kredit))}catch{a=0,l=0}let n=[],t="00";e.map(r=>{r.tanggal!=t&&(t=r.tanggal,n[`${parseInt(t)}`]={total:{kredit:0,debet:0},tanggal:r.tanggal,bulan:r.bulan,tahun:r.tahun,hari:h[new Date(`${r.tahun}-${r.bulan}-${t}`).getDay()]});let u=e.filter(i=>i.tanggal==t);n[`${parseInt(t)}`].total={debet:u.reduce((i,k)=>i+b(k.debet),0),kredit:u.reduce((i,k)=>i+b(k.kredit),0)};let d=[],s=[];u.map(i=>{d.indexOf(i.bukti_transaksi)<0&&(d.push(i.bukti_transaksi),s.push({bukti_transaksi:i.bukti_transaksi,data:f(u.filter(k=>k.bukti_transaksi==i.bukti_transaksi)),debet:o(u.filter(k=>k.bukti_transaksi==i.bukti_transaksi).map(k=>k.debet)),kredit:o(u.filter(k=>k.bukti_transaksi==i.bukti_transaksi).map(k=>k.kredit)),tanggal:i.tanggal,bulan:i.bulan,tahun:i.tahun,sumber:i.sumber}))}),n[`${parseInt(t)}`].buktiTransaksi=s}),g({totalDebet:a,totalKredit:l,returnData:n})}),S=(e,g,_)=>new Promise((a,l)=>{let n=[];g!=null&&g.transaksiList.forEach((u,d)=>{u.concat(_).map(s=>{let i="DELETE",k=e.transaksiList[d]!=null?e.transaksiList[d].filter(p=>p.uuid==s.uuid):[];k.length>0&&(i="PUT",s=k[0]),s.uuid&&n.push({tanggal:new Date(e.hariTanggal).getDate().toString(),bulan:(new Date(e.hariTanggal).getMonth()+1).toString(),tahun:new Date(e.hariTanggal).getFullYear().toString(),waktu:s.waktu,uraian:s.uraian,debet:s.debet.toString(),kredit:s.kredit.toString(),kode_akun_uuid:s.kodeAkun.value,bukti_transaksi:e.buktiTransaksi,transaksi:d,uuid:s.uuid,status:i})})}),e.transaksiList.forEach((u,d)=>{u.forEach(s=>{s.uuid||n.push({tanggal:new Date(e.hariTanggal).getDate().toString(),bulan:(new Date(e.hariTanggal).getMonth()+1).toString(),tahun:new Date(e.hariTanggal).getFullYear().toString(),waktu:s.waktu,uraian:s.uraian,debet:s.debet.toString(),kredit:s.kredit.toString(),kode_akun_uuid:s.kodeAkun.value,bukti_transaksi:e.buktiTransaksi,status:"POST",transaksi:d})})});let t=[],r=[];n.map(u=>{u.status!="POST"&&r.indexOf(u.uuid)<0&&(t.push(u),r.push(u.uuid))}),t=t.concat(n.filter(u=>u.status=="POST")),a(t)}),j=(e,g)=>new Promise((_,a)=>{let l=[];e.forEach((n,t)=>{l[t]=[],n.forEach(r=>{l[t].push({waktu:r.waktu,kodeAkun:{label:`${r.kode_akun} - ${r.nama_akun}`,value:g.filter(u=>u.code==r.kode_akun)[0].uuid},uraian:r.uraian,debet:r.debet,kredit:r.kredit,uuid:r.uuid})})}),_(l)});export{w as a,T as b,j as c,D as g,S as n};
