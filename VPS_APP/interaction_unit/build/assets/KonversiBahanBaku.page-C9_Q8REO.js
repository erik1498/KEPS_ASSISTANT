import{r,j as a,h as H,aP as T,s as w,O as D,b as O,k as A,aQ as F,n as N,ax as I,aH as J,R as W,u as Y,o as q,e as M,p as Q,i as X,a as Z,F as E,q as aa}from"./index-BFtBgOrg.js";import{P as ea}from"./PageTitle-Hc-YSVDI.js";import{F as ta,f as C,W as na}from"./Wrap-Dk-wg8kL.js";import{P as sa}from"./Pagination-CNke5GoU.js";import{F as P}from"./FormInputWithLabel-zEsdZ3IQ.js";import{F as G}from"./FormSelectWithLabel-BuQTQxHx.js";import{i as R}from"./actionEvent.helper-BujKUZ7B.js";import{p as $}from"./number.helper-efe0YCx6.js";import{F as V}from"./FormInput-DctP6iug.js";import{P as ua,l as la}from"./PDFHeader-BGA35-Z9.js";import"./react-paginate-C1eAq6Tf.js";import"./index-BKNjMPK8.js";const z=({konversiBahanBaku:d,satuanBahanBakuKonversiBahanBaku:t,preview:o})=>{const[_,g]=r.useState([]),[c,x]=r.useState([]),[j,k]=r.useState([]),m=()=>{T.custom(`/by_konversi_bahan_baku/${d.uuid}`).then(e=>{g(u=>e.data)}).catch(e=>w(e))},p=(e,u)=>{let n=c;n=n.map(s=>(s.stok_awal_bahan_baku==u&&(s.jumlah_yang_dikonversi=e),s)),x(s=>n)},K=(e,u)=>{let n=c;n=n.map(s=>(s.stok_awal_bahan_baku==u&&(s.jumlah_hasil_konversi_kode_bahan_baku_tujuan=e),s)),x(s=>n)},B=(e,u)=>{let n=c;n=n.map(s=>(s.stok_awal_bahan_baku==u&&(s.stok_awal_bahan_baku_tujuan=e.value),s)),x(s=>n)},v=()=>{c.map(async e=>{await T.custom(e.uuid?`/${e.uuid}`:"",e.uuid?"PUT":"POST",null,{data:{konversi_bahan_baku:d.uuid,stok_awal_bahan_baku:e.stok_awal_bahan_baku,jumlah_yang_dikonversi:`${e.jumlah_yang_dikonversi}`,stok_awal_bahan_baku_tujuan:e.stok_awal_bahan_baku_tujuan,jumlah_hasil_konversi_kode_bahan_baku_tujuan:`${e.jumlah_hasil_konversi_kode_bahan_baku_tujuan}`}}).catch(u=>w(u))})},f=e=>{const u=_.filter(n=>n.stok_awal_bahan_baku==e);return u.length>0?{label:u[0].kategori_harga_bahan_baku_kode_bahan_baku,value:u[0].satuan_bahan_baku_name}:null},b=e=>{const u=_.filter(n=>n.stok_awal_bahan_baku==e);return u.length>0?u[0].satuan_bahan_baku_name:null};return r.useEffect(()=>{const e=_.filter(n=>n.satuan_bahan_baku_uuid==t.value),u=_.filter(n=>n.satuan_bahan_baku_uuid!=t.value);x(n=>e),k(n=>u)},[_]),r.useEffect(()=>{m()},[d]),a.jsx(a.Fragment,{children:a.jsxs("div",{className:"my-5 bg-white py-5 rounded-md",children:[a.jsx("h1",{className:"text-xl font-extrabold w-max text-white px-2 rounded-md bg-blue-900 mb-4",children:"Daftar Bahan Baku"}),a.jsx("div",{className:"overflow-x-auto max-h-[40vh] h-max no-scrollbar pb-4",children:a.jsxs("table",{className:"table",children:[a.jsx("thead",{children:a.jsxs("tr",{className:"sticky top-0 z-50 bg-white py-4 text-black",children:[a.jsx("th",{width:12,children:"No"}),a.jsx("th",{children:"Nama Bahan Baku"}),a.jsx("th",{children:"Kode Bahan Baku"}),a.jsx("th",{children:"Satuan Bahan Baku"}),a.jsx("th",{width:150,children:"Jumlah Yang Konversi"}),a.jsx("th",{width:200,children:"Kode Bahan Baku Tujuan"}),a.jsx("th",{children:"Satuan Bahan Baku Tujuan"}),a.jsx("th",{width:150,children:"Jumlah Hasil Konversi Kode Bahan Baku Tujuan"})]})}),a.jsx("tbody",{children:c==null?void 0:c.map((e,u)=>{var n;return a.jsx(a.Fragment,{children:a.jsxs("tr",{children:[a.jsxs("td",{children:[u+1,"."]}),a.jsx("td",{children:e.daftar_bahan_baku_nama_bahan_baku}),a.jsx("td",{children:e.kategori_harga_bahan_baku_kode_bahan_baku}),a.jsx("td",{children:e.satuan_bahan_baku_name}),a.jsx("td",{children:o?a.jsx(a.Fragment,{children:e.jumlah_yang_dikonversi}):a.jsx(a.Fragment,{children:a.jsx(V,{name:"jumlah_yang_dikonversi",type:"text",other:{defaultValue:e.jumlah_yang_dikonversi},onchange:s=>{R(s),p(s.target.value,e.stok_awal_bahan_baku)},value:$(e.jumlah_yang_dikonversi)})})}),a.jsx("td",{children:o?a.jsx(a.Fragment,{children:(n=f(e.stok_awal_bahan_baku_tujuan))==null?void 0:n.label}):a.jsx(a.Fragment,{children:a.jsx(ta,{optionsDataList:j.filter(s=>s.daftar_bahan_baku_uuid==e.daftar_bahan_baku_uuid),optionsLabel:"kategori_harga_bahan_baku_kode_bahan_baku",optionsValue:"stok_awal_bahan_baku",selectValue:f(e.stok_awal_bahan_baku_tujuan),onchange:s=>{B(s,e.stok_awal_bahan_baku)},selectName:"satuanBahanBakuKonversiBahanBaku"})})}),a.jsx("td",{children:b(e.stok_awal_bahan_baku_tujuan)}),a.jsx("td",{children:o?a.jsx(a.Fragment,{children:e.jumlah_hasil_konversi_kode_bahan_baku_tujuan}):a.jsx(a.Fragment,{children:a.jsx(V,{name:"jumlah",type:"text",other:{defaultValue:e.jumlah_hasil_konversi_kode_bahan_baku_tujuan},onchange:s=>{R(s),K(s.target.value,e.stok_awal_bahan_baku)},value:$(e.jumlah_hasil_konversi_kode_bahan_baku_tujuan)})})})]},u)})})})]})}),o?a.jsx(a.Fragment,{}):a.jsx(a.Fragment,{children:a.jsxs("button",{className:"btn btn-sm bg-green-800 mt-3 text-white",onClick:()=>{v()},children:[a.jsx(H,{})," Simpan"]})})]})})},ha=({setAddKonversiBahanBakuEvent:d=()=>{},konversiBahanBakuEdit:t,getData:o=()=>{}})=>{const[_,g]=r.useState(t!=null&&t.tanggal?t.tanggal:D()),[c,x]=r.useState(t!=null&&t.kode_konversi_bahan_baku?t.kode_konversi_bahan_baku:""),[j,k]=r.useState(t!=null&&t.daftar_gudang?t.daftar_gudang:""),[m,p]=r.useState(t!=null&&t.satuan_bahan_baku?t.satuan_bahan_baku:""),[K,B]=r.useState([]),[v,f]=r.useState([]),[b,e]=r.useState(),u=async()=>{await A()&&F.custom(`${t!=null&&t.uuid?`/${t.uuid}`:""}`,t?"PUT":"POST",null,{data:{tanggal:_,kode_konversi_bahan_baku:c,daftar_gudang:j.value,satuan_bahan_baku:m.value}}).then(l=>{t?(e(y=>t),N("Berhasil","Data berhasil diupdate")):(e(y=>l.data),N("Berhasil","Data berhasil disimpan"))}).catch(l=>{w(l)})},n=()=>{I.custom("","GET").then(l=>{if(B(y=>l.data.entry),l.data.entry.length>0){if(t){C({editObject:t.daftar_gudang,dataList:l.data.entry,setState:k,labelKey:"name",valueKey:"uuid"});return}k({label:l.data.entry[0].name,value:l.data.entry[0].uuid})}})},s=()=>{J.custom("","GET").then(l=>{if(f(y=>l.data.entry),l.data.entry.length>0){if(t){C({editObject:t.satuan_bahan_baku,dataList:l.data.entry,setState:p,labelKey:"name",valueKey:"uuid"});return}p({label:l.data.entry[0].name,value:l.data.entry[0].uuid})}})};return r.useEffect(()=>{n(),s()},[]),a.jsx(a.Fragment,{children:a.jsxs("div",{className:"bg-white px-6 py-3 rounded-md shadow-2xl",children:[a.jsxs("div",{className:"mb-3 flex justify-between items-center",children:[a.jsxs("h1",{className:"uppercase text-gray-600 font-bold",children:[t?"Edit":"Tambahkan"," Konversi Bahan Baku"]}),a.jsxs("button",{className:"btn btn-sm bg-red-900 text-white border-none",onClick:()=>{o(),d()},children:[a.jsx(O,{})," Batalkan Konversi Bahan Baku"]})]}),a.jsxs("div",{className:"flex gap-x-2",children:[a.jsx(P,{label:"Tanggal Konversi Bahan Baku",type:"datetime-local",onchange:l=>{g(l.target.value)},others:{value:_,disabled:b,tanggal:"tanggalKonversiBahanBaku"}}),a.jsx(P,{label:"Kode Konversi Bahan Baku",type:"text",onchange:l=>{x(l.target.value)},others:{value:c,disabled:b,tanggal:"kodeKonversiBahanBaku"}}),a.jsx(G,{label:"Gudang",optionsDataList:K,optionsLabel:"name",optionsValue:"uuid",selectValue:j,disabled:b,onchange:l=>{k(l)},selectName:"gudangKonversiBahanBaku"}),a.jsx(G,{label:"Satuan Bahan Baku",optionsDataList:v,optionsLabel:"name",optionsValue:"uuid",selectValue:m,disabled:b,onchange:l=>{p(l)},selectName:"satuanBahanBakuKonversiBahanBaku"})]}),b?a.jsx(a.Fragment,{children:a.jsx(z,{konversiBahanBaku:b,satuanBahanBakuKonversiBahanBaku:m})}):a.jsx(a.Fragment,{children:a.jsxs("button",{className:"btn btn-sm bg-green-800 mt-4 text-white",onClick:()=>{u()},children:[a.jsx(H,{})," Simpan"]})}),t&&!b?a.jsx(a.Fragment,{children:a.jsx(z,{konversiBahanBaku:t,satuanBahanBakuKonversiBahanBaku:{value:t.satuan_bahan_baku},preview:!0})}):a.jsx(a.Fragment,{})]})})},ra=W.forwardRef((d,t)=>{var o;return a.jsxs("div",{ref:t,children:[a.jsx(ua,{bulan:d.bulan,tahun:d.tahun,title:"Konversi Bahan Baku"}),a.jsxs("table",{className:"table",children:[a.jsx("thead",{children:a.jsxs("tr",{className:"sticky top-0 bg-white py-4 text-black",children:[a.jsx("th",{width:12,children:"No"}),a.jsx("th",{children:"Nama Konversi Bahan Baku"})]})}),a.jsx("tbody",{children:(o=d==null?void 0:d.data)==null?void 0:o.map((_,g)=>a.jsx(a.Fragment,{children:a.jsxs("tr",{children:[a.jsx("td",{children:g+1}),a.jsx("td",{children:_.name})]},g)}))})]})]})}),fa=()=>{const d=Y(),{data:t}=d,[o,_]=r.useState([]),[g,c]=r.useState(!1),[x,j]=r.useState(!1),[k,m]=r.useState({name:""}),[p,K]=r.useState(!1),[B,v]=r.useState(""),f=r.useRef(),b=la.useReactToPrint({content:()=>f.current}),[e,u]=r.useState({page:1,size:10,count:118,lastPage:12}),n=(i="")=>{i==""&&v(i),c(!0),F.custom(`?search=${i}&page=${e.page}&size=${e.size}&tahun=${t.tahun}`,"GET").then(h=>{var S,L;K(i.length<1),_((S=h==null?void 0:h.data)==null?void 0:S.entry),u((L=h==null?void 0:h.data)==null?void 0:L.pagination),c(!1)}).catch(h=>{w(h)})},s=i=>{let h=o[i];m(h),j(!x)},l=async i=>{if(await aa("Hapus","Yakin ingin hapus data ini ?")){let h=o[i];F.custom(`/${h.uuid}`,"DELETE").then(()=>{N("Berhasil","Data berhasil dihapus"),n()}).catch(S=>{w(S)})}},y=({selected:i})=>{let h=e;h.page=i+1,u(h),n()},U=i=>{let h=e;h.size=i,h.page=1,u(h),n()};return r.useEffect(()=>{n()},[]),a.jsx(na,{isLoading:g,children:a.jsxs("div",{children:[a.jsx(ea,{title:"Konversi Bahan Baku"}),x?a.jsx(ha,{setAddKonversiBahanBakuEvent:()=>j(!1),getData:n,konversiBahanBakuEdit:k}):a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"bg-white py-3 px-6 mb-3 rounded-md flex justify-between shadow-2xl",children:[a.jsxs("label",{className:"input input-sm input-bordered flex items-center gap-2 bg-white",children:[a.jsx("input",{type:"text",className:"grow bg-transparent",placeholder:"Cari",value:B,onChange:i=>v(i.target.value)}),p?a.jsx(q,{onClick:()=>{n(B)},className:"cursor-pointer"}):a.jsx(O,{onClick:()=>n(""),className:"cursor-pointer"})]}),a.jsxs("div",{className:"flex gap-x-2 items-center",children:[a.jsxs("button",{className:"btn btn-sm bg-blue-900 text-white border-none",onClick:()=>{m(null),j(!x)},children:[a.jsx(M,{})," Tambah Konversi Bahan Baku"]}),a.jsx("div",{className:"hidden",children:a.jsx(ra,{data:o,ref:f,bulan:Q(new Date().getMonth()),tahun:t.tahun})}),a.jsxs("button",{onClick:b,className:"btn btn-sm bg-red-600 hover:bg-red-600 text-white border-red-600",children:[a.jsx(X,{})," Cetak Konversi Bahan Baku"]})]})]}),a.jsx("div",{className:"overflow-x-auto bg-white shadow-xl rounded-md h-[50vh] no-scrollbar px-6 pb-4",children:a.jsxs("table",{className:"table",children:[a.jsx("thead",{children:a.jsxs("tr",{className:"sticky top-0 bg-white py-4 text-black",children:[a.jsx("th",{width:12,children:"No"}),a.jsx("th",{children:"Tanggal"}),a.jsx("th",{children:"Kode"}),a.jsx("th",{children:"Aksi"})]})}),a.jsx("tbody",{children:o==null?void 0:o.map((i,h)=>a.jsx(a.Fragment,{children:a.jsxs("tr",{children:[a.jsxs("td",{children:[h+1,"."]}),a.jsx("td",{children:i.tanggal}),a.jsx("td",{children:i.kode_konversi_bahan_baku}),a.jsxs("td",{className:"flex gap-x-2",children:[a.jsx(Z,{size:12,className:"text-yellow-500 cursor-pointer",onClick:()=>{s(h)}}),a.jsx(E,{size:12,className:"text-red-500 cursor-pointer",onClick:()=>{l(h)}})]})]},h)}))})]})}),a.jsx(sa,{paginateUpdatePage:y,paginate:e,setSize:U})]})]})})};export{fa as default};
