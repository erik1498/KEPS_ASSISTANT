FROM node:20.11.1-alpine

WORKDIR /usr/process_unit/workdir

COPY . .

RUN npm install -g npm@latest
RUN npm install -g pnpm@latest
RUN npm install -g pm2
RUN pnpm install

ARG DB_HOST
ARG CLIENT_HOST
ARG USER_PERMISSION_SECURITY_ENABLED
ARG USER_PARAMETER_SECURITY_ENABLED

ENV PORT=2001
ENV JWT_SECRET=e67453f721877d9d41b611601338046cbf7dedcf137b92d2f596eedfe82be87c
ENV JWT_ENCRYPT_KEY=keps_assistant_iobuaodb
ENV REFRESH_SECRET=96552387ade2fbb615bf522b2a5601d636759b008b60bf658c89341f8ecf6cd1
ENV REFRESH_ENCRYPT_KEY=keps_assistant_iohdnasi
ENV ENCRYPT_KEY=keps_assistant_12345@@%
ENV DB_HOST=${DB_HOST}
ENV CLIENT_HOST=${CLIENT_HOST}
ENV USER_PERMISSION_SECURITY_ENABLED=${USER_PERMISSION_SECURITY_ENABLED}
ENV USER_PARAMETER_SECURITY_ENABLED=${USER_PARAMETER_SECURITY_ENABLED}
ENV DB_PORT=3306
ENV DB_USER=root
ENV DB_PASSWORD=root
ENV DB_NAME=db_keps_assistant
ENV LICENSE_KEY=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
ENV USER_PARAMETER_KEY=dBSAjoiahsoaihsOOJoSNAOsnsadoqe

EXPOSE 2001

CMD ["pnpm", "run", "start"]
